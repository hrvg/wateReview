---
title: "LDA comparison"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{LDA comparison}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# Purpose

In this vignette, we compare the topics outputted by topic modelling on three different corpora in English, Spanish and Porturguese.

# Data loading

We access the topic lists stored in `extdata` using `system.file()`.

```{r}
library(dplyr)
library(reshape2)
en <- read.csv(system.file(
    "extdata",
    "topic_names_en.csv",
    package = "wateReview")
) %>% mutate(lang = "en") %>% melt(id.vars = c("topic_id","lang"))
es <- read.csv(system.file(
    "extdata",
    "topic_names_es.csv",
    package = "wateReview")
) %>% mutate(lang = "es") %>% melt(id.vars = c("topic_id","lang"))
pt <- read.csv(system.file(
    "extdata",
    "topic_names_pt.csv",
    package = "wateReview"),
    na.strings=c("","NA")
) %>% mutate(lang = "pt") %>% melt(id.vars = c("topic_id","lang"))
x <- rbind(en, es, pt) %>% na.omit()
```

```
library(reshape2)
library(ggpubr)
library(tidyr)
library(ggplot2)
library(forcats)

######## filter #############
x2 <- x %>%
  filter(variable == "NSF_specific") %>%
  group_by(value, lang) %>%
  tally


# need to order based on engligh numbers + number of overall topics
x2$nlang <- x2 %>% 
  group_by(value) %>% 
  group_map(~ rep(length(table(.x$lang)), length(table(.x$lang)))) %>% 
  unlist()

lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]

x2$value <- factor(x2$value, levels = lvls)

x2 <- na.omit(x2) # missing 1 spanish?

x2$lang <- factor(x2$lang, labels = c("English", "Spanish", "Portuguese"))

######## heat map #############

a <- ggplot(data = x2, aes(x = lang, y = fct_reorder(value, nlang))) +
  geom_tile(aes(fill = nlang, width=0.9, height=0.9)) +
  geom_text(aes(label = n))
a

a + 
  scale_fill_gradient(low = "grey89",
                      high = "grey50") +
  labs(title= "Topic model coverage",
       y="NSF specific categories",
       x = "Topic model for each language") +
  theme_pubr() +  
  theme(axis.text.y = element_text(face = c('plain','plain','plain', 'plain', 'plain', 'plain', 'plain',
                                            'plain', 'bold', 'plain', 'plain', 'plain',
                                            'plain', 'plain', 'plain', 'bold', 'plain',
                                            'plain', 'plain', 'plain', 'plain', 'plain',
                                            'plain', 'bold', 'plain', 'plain', 'bold',
                                            'bold', 'bold', 'plain', 'plain', 'bold', 
                                            'bold', 'plain', 'bold','bold', 'bold', # 6-10
                                            'bold', 'bold', 'bold','bold','bold' # 1-5
                                            ))) +
  rremove("legend")






# plotly::ggplotly(a)

######## dot chart #############
ggbarplot(x2, x = "value", y = "n", 
          fill = "lang",
          color = "white",
          palette = c("#00AFBB", "#FC4E07",  "#E7B800"),
          rotate = TRUE)
```