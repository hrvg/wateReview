theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
risk <- df
View(risk)
colnames(c("country","risk"))
colnames(risk,c("country","risk"))
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggdotchart(df2,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
risk <- df
# combine
risk_country <- df
risk_yar <- df2
View(risk_country)
View(risk_yar)
topic_pick <- "risk assessment"
theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
df2<- aggregate(df2$value, by=list(df2$year), FUN=sum)
ggdotchart(df,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
# combine
risk_country <- df
risk_yar <- df2
View(risk)
topic_pick <- "climate change impacts"
theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
theme_topic <- remove_irrelevant(theme) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
df2<- aggregate(df2$value, by=list(df2$year), FUN=sum)
climate_country <- df
climate_year <- df2
View(climate_year)
df <-cbind(risk_country, climate_country)
View(df)
df <- df %>%
rename(Group.1 = country, x = risk)
names(df)[2]<-"risk"
names(df)[4]<-"climate"
names(df)[4]<-"climate change impacts"
df2 <-cbind(risk_yar, climate_year)
names(df2)[2]<-"risk assessment"
names(df2)[4]<-"climate change impacts"
View(df2)
df[3] <- NULL    # Wojciech Sobala
df2[3] <- NULL
df <- melt(df,
id.vars = Group.1)
df <- melt(df,
id.vars = "Group.1")
df <-cbind(risk_country, climate_country)
names(df)[2]<-"risk assessment"
names(df)[4]<-"climate change impacts"
df2 <-cbind(risk_yar, climate_year)
names(df2)[2]<-"risk assessment"
names(df2)[4]<-"climate change impacts"
df[3] <- NULL
df2[3] <- NULL
df <- melt(df,
id.vars = "Group.1")
df2 <- melt(df2,
id.vars = "Group.1")
ggdotchart(df,
x= "Group.1", y = "value", color = "variable"
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "value", color = "variable",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x, color = "variable")) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x, color = variable)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggplot(df2, aes(x = Group.1, y = value, color = variable)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "value", color = "variable",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
theme_country <- subset(theme, country == country_pick)
################### ideas #########################
# calculate diversity index
# community = location:
# each paper, all papers in each country, all papers in country clusters, all papers in LAC
# species = topics:
# NSF gemeral, NSF specific, theme, theme subsets, specific theme
# species population = probability or sum of probability
# GOAL:
output <- as.data.frame(unique(res$country))
output <- output %>%
rename(community = `unique(res$country)`) %>%
mutate(nsfgeneral = 0) %>%
mutate(nsfspecific = 0) %>%
mutate(theme = 0) %>%
mutate(themesubset = 0) %>%
mutate(themespecific = 0)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
################### functions #########################
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
sum_country <- function(df) {
sumdf <- data.frame(value=apply(df,2,sum))
sumdf$key=rownames(sumdf)
return(sumdf)
}
country_pick <- "Mexico"
theme_country <- subset(theme, country == country_pick)
View(theme_country)
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
theme_country3 <- remove_country(theme_country)
theme_country2 <- remove_year_country(theme_country)
theme_country2 <- sum_country(theme_country2)
View(theme_country2)
theme_country3 <- remove_country(theme_country)
View(theme_country3)
View(theme_country3)
theme_country3 <- melt(theme_country3,
id.vars = "year")
View(theme_country3)
theme_country3 <- theme_country3 %>%
select(-c("year"))
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
theme_country3 <- theme_country3 %>%
select(-c("variable"))
theme_country3<- aggregate(theme_country3$value, by=list(theme_country3$year), FUN=sum)
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
theme_country3 <- theme_country3 %>%
select(-c("variable"))
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
# theme_country3 <- theme_country3 %>%
#select(-c("variable"))
theme_country3<- aggregate(theme_country3$value,
by=list(theme_country3$variable,theme_country3$year),
FUN=sum)
ggline(theme_country3, x = "Group.2", y = "value", color = "Group.1")
ggline(theme_country3, x = "Group.2", y = "x", color = "Group.1")
################### ideas #########################
# calculate diversity index
# community = location:
# each paper, all papers in each country, all papers in country clusters, all papers in LAC
# species = topics:
# NSF gemeral, NSF specific, theme, theme subsets, specific theme
# species population = probability or sum of probability
# GOAL:
output <- as.data.frame(unique(res$country))
output <- output %>%
rename(community = `unique(res$country)`) %>%
mutate(nsfgeneral = 0) %>%
mutate(nsfspecific = 0) %>%
mutate(theme = 0) %>%
mutate(themesubset = 0) %>%
mutate(themespecific = 0)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
################### functions #########################
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
sum_country <- function(df) {
sumdf <- data.frame(value=apply(df,2,sum))
sumdf$key=rownames(sumdf)
return(sumdf)
}
################### diversity analysis #########################
# calculate diversity by paper / for all of LAC
clean <- remove_year_country(general) #  specify which (species group)
diversity_LA <- diversity_LAC(clean)
diversity_paper <- diversity(clean)
# check - diveristy function from vegan package works
check <- as.data.frame(colSums(clean))
sum <- sum(check)
check$pi <- check$`colSums(clean)`/sum
check$lnpi <- log(check$pi)
check$pilnpi <- check$pi * check$lnpi
H <- -sum(check$pilnpi)
# calculate diversity by country
general2 <- remove_irrelevant(general)
specific2 <- remove_irrelevant(specific)
theme2 <- remove_irrelevant(theme)
general2 <-  diversity_country(general2)
specific2 <- diversity_country(specific2)
theme2 <- diversity_country(theme2)
diversity_by_country<-cbind(general2, specific2,theme2)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2)
fwrite(diversity_by_country, file = "./diversity/diversity by country.csv")
################### diversity graphs #########################
diversity_by_country_graph <- melt(diversity_by_country,
id.vars = c("country"))
# theme
theme_graphdf <- subset(diversity_by_country_graph, variable == "theme")
theme_graph <- ggdotchart(theme_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "theme") +
geom_hline(yintercept = diversity_LA, linetype = 2, color = "lightgray")
# NSF specific
specific_graphdf <- subset(diversity_by_country_graph, variable == "NSFspecific")
specific_graph <- ggdotchart(specific_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "specific")
# NSF general
general_graphdf <- subset(diversity_by_country_graph, variable == "NSFgeneral")
general_graph <- ggdotchart(general_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "general")
theme_graph
specific_graph
general_graph
ggscatter(diversity_by_country, x = "NSFgeneral", y = "theme", color = "country")
country_pick <- "Mexico"
theme_country <- subset(theme, country == country_pick)
theme_country2 <- remove_year_country(theme_country)
theme_country2 <- sum_country(theme_country2)
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
# theme_country3 <- theme_country3 %>%
#select(-c("variable"))
theme_country3<- aggregate(theme_country3$value,
by=list(theme_country3$variable,theme_country3$year),
FUN=sum)
ggline(theme_country3, x = "Group.2", y = "x", color = "Group.1")
View(theme_country3)
View(theme_country2)
View(theme_country2)
View(theme_country3)
sum_country_by_year <- function(df) {
df<- aggregate(df$x, by=list(df$Group.2), FUN=sum)
return(sumdf)
}
sum_country_by_year <- function(df) {
df<- aggregate(df$x, by=list(df$Group.2), FUN=sum)
return(df)
}
theme_country3 <- sum_country_by_year(theme_country3)
ggline(theme_country3, x = "Group.1", y = "x")
theme_country3 <- theme_country3 %>%
select(Group.1 != 2018)
theme_country3 <- theme_country3 %>%
select(Group.1 != "2018")
theme_country3 <- subset(theme_country3, Group.1 != 2018)
ggline(theme_country3, x = "Group.1", y = "x")
theme_country3$cum  <- cumsum(theme_country3$x)
ggline(theme_country3, x = "Group.1", y = "x") # cummulative
ggline(theme_country3, x = "Group.1", y = "cum") # cummulative
ggplot(theme_country3, aes(x = Group.1)) +
ggline(y = x) =
ggline(y = cum)
ggplot(theme_country3, aes(x = Group.1)) +
ggline(y = x) +
ggline(y = cum)
ggplot(theme_country3, aes(x = Group.1)) +
ggline(aes(y = x)) +
ggline(aes(y = cum))
ggplot(theme_country3) +
ggline(aes(x = Group.1, y = x)) +
ggline(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, color = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, fill = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, fill = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr()
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(x = "Number of papers")
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers", x=NULL)
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x), linetype = "dashed") +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers", x=NULL)
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x), linetype = "dashed") +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers on water in Mexico", x=NULL)
general_country <- subset(general, country == country_pick)
general_country2 <- remove_year_country(general_country)
View(general_country2)
general_country2 <- sum_country(general_country2)
pie(general_country2, labels = key, main="Pie Chart")
pie(general_country2$value, labels = general_country2$key, main="Pie Chart")
pie(general_country2$value, labels = general_country2$key, main="Distribution based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of research based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research
based on NSF general categories")
ggpie(general_country2, "value", label = "key")
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = c("#00AFBB", "#E7B800", "#FC4E07") ))
library(wesanderson)
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Chevalier1")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeelig")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeeling")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeeling1")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_fill_manual(values = wes_palette(n=5, name ="Darjeeling1")))
ggpie(general_country2, "value", label = "key",
fill = "group",
palette = scale_fill_manual(values = wes_palette(n=5, name ="Darjeeling1")))
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research
based on NSF general categories")
country_pick <- "Mexico"
View(theme)
View(theme_country)
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme)
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme_corpus)
View(theme_corpus)
theme <- readRDS("./consolidated_results_theme.Rds")
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme_corpus)
View(theme)
theme <- readRDS("./consolidated_results_theme.Rds")
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme_corpus <- melt(theme_corpus)
