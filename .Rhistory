x = "LDA for each language")+
theme_pubr()
a
View(en)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
################### files #########################
setwd("~/R_code/LAC")
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
################### functions #########################
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
col_sums <- function(df) {
df <- colSums(df)
df$key=rownames(df)
return(sumdf)
}
################### subject analysis  #########################
## define data frame
df <- remove_year(budget) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
pca <- ggscatter(topic, x= "prop", y = "diversity",
label = "topic",
label.rectangle = TRUE,
repel = TRUE,
add = "reg.line"
)
pca
View(budget)
View(df)
View(df)
View(budget)
View(df)
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
select(-c("value")) %>%
distinct()
View(topic)
topic$prop <- topic$total/sum(topic$total)
View(budget)
?diversity
View(country_sums)
a <- df %>%
group_by(country,topic) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("value")) %>%
distinct()
View(a)
hist(a %>% filter(topic == "oceanography") %>% select(total))
hist(a %>% filter(topic == "oceanography") %>% select('total))
hist(a %>% filter(topic == "oceanography") %>% select('total'))
hist(a %>% filter(topic == "oceanography") %>% select('total') %>% as.numeric())
a %>% filter(topic == "oceanography") %>% select('total')
hist(a %>% filter(topic == "oceanography") %>% select('total') %>% ungroup())
hist(a %>% filter(topic == "oceanography") %>% ungroup() %>% select('total'))
View(topic)
hist(topic$prop)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
################### files #########################
setwd("~/R_code/LAC")
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
################### functions #########################
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
col_sums <- function(df) {
df <- colSums(df)
df$key=rownames(df)
return(sumdf)
}
################### subject analysis  #########################
## define data frame
df <- remove_year(budget) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
# SAVE for mapping
# write.csv(sums,'./diversity/csvs/nsfspecific.csv')
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
a <- df %>%
group_by(country,topic) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("value")) %>%
distinct()
## topic description
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
pca <- ggscatter(topic, x= "prop", y = "diversity",
label = "topic",
label.rectangle = TRUE,
repel = TRUE,
add = "reg.line"
)
pca
budget2 <- remove_irrelevant(budget)
budget2 <- diversity_country(budget2)
budget2 <- remove_irrelevant(budget)
budget2 <- diversity_country(budget2)
theme2 <- remove_irrelevant(theme)
theme2 <- diversity_country(theme2)
View(theme2)
View(theme)
View(budget2)
View(budget)
general2 <- remove_irrelevant(general)
specific2 <- remove_irrelevant(specific)
theme2 <- remove_irrelevant(theme)
budget2 <- remove_irrelevant(budget)
general2 <-  diversity_country(general2)
specific2 <- diversity_country(specific2)
theme2 <- diversity_country(theme2)
budget2 <- diversity_country(budget2)
diversity_by_country<-cbind(general2, specific2,theme2, budget2)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2)
View(diversity_by_country)
diversity_by_country<-cbind(general2, specific2,theme2, budget2)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2, budget = x3)
diversity_by_country<-cbind(general2, specific2,theme2, budget2)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2","country3")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2, budget = x3)
# SAVE
write.csv(diversity_by_country, file = "./diversity/csvs/diversity.csv")
setwd("~/R_code/LAC")
source("lib_lac.R") # functions
setwd("~/R_code/LAC")
source("./diversity/lib_lac.R")
setwd("~/R_code/LAC")
source("./diversity/lib_lac.R")
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
## define data frame
df <- remove_year(budget) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
View(sums)
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
View(country_sums)
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
View(sums)
View(sums)
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
View(country)
a <- df %>%
group_by(country,topic) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("value")) %>%
distinct()
View(country_sums)
View(country)
View(sums)
View(country)
View(country_sums)
View(country)
View(country_sums)
sum %>% group_by(coutry) %>% sum(sums)
sums %>% group_by(coutry) %>% sum(sums)
sums %>% group_by(country) %>% sum(sums)
country_prop <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sums))
country_prop <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum))
View(country_prop)
sum(subset(country_prop, country == Argentina), prop)
a <- subset(country_prop, country == "Argentina")
View(a)
sum(a$pop)
sum(a$prop)
setwd("~/R_code/LAC")
source("./diversity/lib_lac.R")
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
################### analysis  #########################
## define data frame
df <- remove_year(budget) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
View(country_sums)
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum)
names(country_sums) = c("country","no.papers")
sums <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum))
hist(sums$prop)
hist(sums$prop[country == "Argentina"])
hist(sums$prop[country == "Brazil"])
?kstest
??kstest
?ks.test
?rnorm
View(budget)
View(country)
View(country_sums)
View(budget)
View(df)
View(sums)
x <- rnorm(17)
x <- rnorm(17)
a <- subset(sums, topic == "oceanography")
View(a)
ks.test(a,x)
ks.test(a,x)
ks.test(a, x)
x <- as.dataframe(rnorm(17)) # set to # of countries (# of observations)
x <- as.data.frame(rnorm(17)) # set to # of countries (# of observations)
x <- as.data.frame(rnorm(12)) # set to # of countries (# of observations)
x2 <- subset(sums, topic == "oceanography")
ks.test(x, x2)
View(x2)
ks.test(x, x2$prop)
x <- as.data.frame(rnorm(12)) # set to # of countries (# of observations)
x2 <- subset(sums, topic == "oceanography")
ks.test(x, x2$prop)
View(x)
hist(x)
hist(x$`rnorm(12)`)
dist(sums)
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
View(topic)
?diversity
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
mutate(distance = dist(value)) $>$
select(-c("value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
mutate(diversity = diversity(value)) %>%
mutate(distance = dist(value)) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
a <- df %>%
select(-"country") %>%
group_by(topic) %?%
mutate(distance = dist(value))
a <- df %>%
select(-"country") %>%
group_by(topic) %>%
mutate(distance = dist(value))
View(topic)
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
#mutate(sd = sd(value)) %>%
#mutate(mean = mean(value)) %>%
#mutate(var = var(value)) %>% # Variance measures the dispersion of a set of data points around their mean value
#mutate(cv = sd/mean) %>% # extent of variability in relation to the mean of the population
#mutate(diversity = diversity(value)) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
?jsd
View(df)
View(budget)
a <- remove_country(budget)
a <- remove_year_country(budget)
View(a)
b <- dist(a)
install.packages('philentropy')
library(philentropy)
b <- distance(a)
b <- distance(a, use.row.names = TRUE)
12702*19
