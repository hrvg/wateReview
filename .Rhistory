labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "cadetblue1", high = "cadetblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.7, height=0.7))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.9, height=0.9))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue14") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
plotly::ggplotly(a)
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a<- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
plotly::ggplotly(a)
a<- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a
View(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
View(x2)
######## graphing #############
ggbarplot(x2, x = "value", y = "n",
fill = "lang",
color = "white",
palette = c("#00AFBB", "#FC4E07",  "#E7B800"),
rotate = TRUE)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a
plotly::ggplotly(a)
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
## need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
## need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
View(x2)
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x2 <- na.rm(x2)
View(x)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
#filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x <- rbind(en2,es2,pt2)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
group_by(value, lang) %>%
tally
library(dplyr)
library(reshape2)
library(ggpubr)
library(tidyr)
library(ggplot2)
######## load data #############
en <- read.csv("./topic_names_en.csv")
es <- read.csv("./topic_names_es.csv")
pt <- read.csv("./topic_names_pt.csv", na.strings=c("","NA"))
en$lang <- "en"
es$lang <- "es"
pt$lang <- "pt"
en2 <- melt(en,
id.vars = c("topic_id","lang"))
es2 <- melt(es,
id.vars = c("topic_id","lang"))
pt2 <- melt(pt,
id.vars = c("topic_id","lang"))
x <- rbind(en2,es2,pt2)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
group_by(value, lang) %>%
tally
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.9, height=0.9)) # edit for specific vs. general
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
View(en)
################### pseudocode #########################
# start with 1 topic
# calculate distance from normal distribution for 2 data frames
## 1 - % of research devoted to each topic within a country
## 2- probability of a topic in each document
# subset main df to countries with > 30 papers
# rescale value
# graph density distribution of corpus data + a normal distribution
# extract info both graphs - compare "y"s
# calculate distance - sqrt of JSD
################### code #########################
# define subset
probs <- reduce_docs_for_JSd(budget)
# x axis
# calculate distance from normal for %  of research done in each country
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>%
group_by(topic) %>%
mutate(scaled = scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd)
names(country_distance) <- unique(df$topic)
get_JSd('reservoirs', plot = T)
# y axis
# calculate distance from normal for all documents
## RE DO - MEDIAN OF COUNTRIES?
df <- probs %>%
group_by(country) %>%
mutate(prop = value/sum(value)) %>% # added proportion to account for influence of country
mutate(scaled= scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
topic_distance <- sapply(unique(df$topic), get_JSd)
names(topic_distance) <- unique(df$topic)
################### graph #########################
country_distance <- as.data.frame(country_distance)
topic_distance <- as.data.frame(topic_distance)
distance <- cbind(country_distance, topic_distance)
distance$topic <- rownames(distance)
ggscatter(distance, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE)
setwd("~/R_code/LAC")
source("./diversity/lib_lac.R")
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
library(philentropy)
library(scales)
library(ggplotify)
library(plotly)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
################### pseudocode #########################
# start with 1 topic
# calculate distance from normal distribution for 2 data frames
## 1 - % of research devoted to each topic within a country
## 2- probability of a topic in each document
# subset main df to countries with > 30 papers
# rescale value
# graph density distribution of corpus data + a normal distribution
# extract info both graphs - compare "y"s
# calculate distance - sqrt of JSD
################### code #########################
# define subset
probs <- reduce_docs_for_JSd(budget)
# x axis
# calculate distance from normal for %  of research done in each country
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>%
group_by(topic) %>%
mutate(scaled = scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd)
names(country_distance) <- unique(df$topic)
get_JSd('reservoirs', plot = T)
# y axis
# calculate distance from normal for all documents
## RE DO - MEDIAN OF COUNTRIES?
df <- probs %>%
group_by(country) %>%
mutate(prop = value/sum(value)) %>% # added proportion to account for influence of country
mutate(scaled= scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
topic_distance <- sapply(unique(df$topic), get_JSd)
names(topic_distance) <- unique(df$topic)
################### graph #########################
country_distance <- as.data.frame(country_distance)
topic_distance <- as.data.frame(topic_distance)
distance <- cbind(country_distance, topic_distance)
distance$topic <- rownames(distance)
ggscatter(distance, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE)
# interactive graphs
# a <- ggplot(distance, aes(x = country_distance, y = topic_distance, group = topic)) + geom_point() + theme_pubr()
# ggplotly(a, tooltip = c('topic'))
################### pseudocode #########################
# start with 1 topic
# calculate distance from normal distribution for 2 data frames
## 1 - % of research devoted to each topic within a country
## 2- probability of a topic in each document
# subset main df to countries with > 30 papers
# rescale value
# graph density distribution of corpus data + a normal distribution
# extract info both graphs - compare "y"s
# calculate distance - sqrt of JSD
################### code #########################
# define subset
probs <- reduce_docs_for_JSd(methods)
# x axis
# calculate distance from normal for %  of research done in each country
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>%
group_by(topic) %>%
mutate(scaled = scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd)
names(country_distance) <- unique(df$topic)
get_JSd('reservoirs', plot = T)
# y axis
# calculate distance from normal for all documents
## RE DO - MEDIAN OF COUNTRIES?
df <- probs %>%
group_by(country) %>%
mutate(prop = value/sum(value)) %>% # added proportion to account for influence of country
mutate(scaled= scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
topic_distance <- sapply(unique(df$topic), get_JSd)
names(topic_distance) <- unique(df$topic)
################### graph #########################
# REDO _ FIX AXES
country_distance <- as.data.frame(country_distance)
topic_distance <- as.data.frame(topic_distance)
distance <- cbind(country_distance, topic_distance)
distance$topic <- rownames(distance)
ggscatter(distance, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE)
# interactive graphs
# a <- ggplot(distance, aes(x = country_distance, y = topic_distance, group = topic)) + geom_point() + theme_pubr()
# ggplotly(a, tooltip = c('topic'))
################### pseudocode #########################
# start with 1 topic
# calculate distance from normal distribution for 2 data frames
## 1 - % of research devoted to each topic within a country
## 2- probability of a topic in each document
# subset main df to countries with > 30 papers
# rescale value
# graph density distribution of corpus data + a normal distribution
# extract info both graphs - compare "y"s
# calculate distance - sqrt of JSD
################### code #########################
# define subset
probs <- reduce_docs_for_JSd(specific)
# x axis
# calculate distance from normal for %  of research done in each country
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>%
group_by(topic) %>%
mutate(scaled = scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd)
names(country_distance) <- unique(df$topic)
get_JSd('reservoirs', plot = T)
# y axis
# calculate distance from normal for all documents
## RE DO - MEDIAN OF COUNTRIES?
df <- probs %>%
group_by(country) %>%
mutate(prop = value/sum(value)) %>% # added proportion to account for influence of country
mutate(scaled= scale(prop)) %>%
ungroup() %>%
select(c("topic","scaled"))
topic_distance <- sapply(unique(df$topic), get_JSd)
names(topic_distance) <- unique(df$topic)
################### graph #########################
# REDO _ FIX AXES
country_distance <- as.data.frame(country_distance)
topic_distance <- as.data.frame(topic_distance)
distance <- cbind(country_distance, topic_distance)
distance$topic <- rownames(distance)
ggscatter(distance, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE)
# interactive graphs
# a <- ggplot(distance, aes(x = country_distance, y = topic_distance, group = topic)) + geom_point() + theme_pubr()
# ggplotly(a, tooltip = c('topic'))
a <- ggplot(distance, aes(x = country_distance, y = topic_distance, group = topic)) + geom_point() + theme_pubr()
a <- ggplot(distance, aes(x = country_distance, y = topic_distance, group = topic)) + geom_point() + theme_pubr()ggplotly(a, tooltip = c('topic'))
ggplotly(a, tooltip = c('topic'))
a <- ggplot(distance, aes(y = country_distance, x = topic_distance, group = topic)) + geom_point() + theme_pubr()
ggplotly(a, tooltip = c('topic'))
