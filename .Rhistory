################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
general <- readRDS("./fishy.R")
################### libraries #########################
library(ggplot2)
library(ggpubr)
library(reshape2)
library(RColorBrewer)
library(wesanderson)
library(dplyr)
library(ggExtra)
library(cowplot)
library(gridExtra)
################### files #########################
dir <- "./Data/publication"
soil <- read.csv(file.path(dir,'soil.csv'), header = TRUE, sep = ",", check.names = FALSE)
et <- read.csv(file.path(dir,'et.csv'), header = TRUE, sep = ",", check.names = FALSE)
################### fix soil #########################
soil$type <- factor(soil$type, levels = c("tom", "alm", "almnv"))
levels(soil$type) <- c("Annual rotation field with
winter cover crop seed",
"Almond orchard with
winter cover crop seed",
"Almond orchard
with native vegetation")
soil <- melt(soil,
id.vars = c("site","type","number")) # edited csv files to keep only necessary dates and data
soil_diff <- subset(soil, variable == "percentdif")
soil_compare <- subset(soil, variable != "percentdif")
soil_compare$variable <- factor(soil_compare$variable, levels = c("ccmore","controlmore"))
levels(soil_compare$variable) <- c("More water in cover crop",
"More water in control")
################### figure 2 #########################
# bar  charts
ggdotchart(soil_diff, x = "site", y = "value",
color = "type",
palette = c("#00AFBB", "#FC4E07", "#E7B800"),
group = "type",
add = "segments",
add.params = list(color = "lightgray", size = 1),
rotate = TRUE,
dot.size = 4) +
xlab(NULL) +
ylab("Percent of time soil moisture differs between treatments (%)")
################### libraries #########################
library(ggplot2)
library(ggpubr)
library(reshape2)
library(RColorBrewer)
library(wesanderson)
library(dplyr)
library(ggExtra)
library(cowplot)
library(gridExtra)
################### files #########################
dir <- "./Data/publication"
soil <- read.csv(file.path(dir,'soil.csv'), header = TRUE, sep = ",", check.names = FALSE)
et <- read.csv(file.path(dir,'et.csv'), header = TRUE, sep = ",", check.names = FALSE)
################### fix soil #########################
soil$type <- factor(soil$type, levels = c("tom", "alm", "almnv"))
levels(soil$type) <- c("Annual rotation field with
winter cover crop seed",
"Almond orchard with
winter cover crop seed",
"Almond orchard
with native vegetation")
soil <- melt(soil,
id.vars = c("site","type","number")) # edited csv files to keep only necessary dates and data
soil_diff <- subset(soil, variable == "percentdif")
soil_compare <- subset(soil, variable != "percentdif")
soil_compare$variable <- factor(soil_compare$variable, levels = c("ccmore","controlmore"))
levels(soil_compare$variable) <- c("More water in cover crop",
"More water in control")
################### libraries #########################
library(ggplot2)
library(ggpubr)
library(reshape2)
library(RColorBrewer)
library(wesanderson)
library(dplyr)
library(ggExtra)
library(cowplot)
library(gridExtra)
dir <- "./Data/publication"
soil <- read.csv(file.path(dir,'soil.csv'), header = TRUE, sep = ",", check.names = FALSE)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
################### files #########################
setwd("~/R_code/LAC")
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
################### functions #########################
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
col_sums <- function(df) {
df <- colSums(df)
df$key=rownames(df)
return(sumdf)
}
################### subject analysis  #########################
## define data frame
df <- remove_year(budget)
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
sums <-aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
## calculate country + topic sums
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
topic_sums <- aggregate(sums$sum, by=list(sums$topic), FUN=sum)
names(topic_sums) = c("topic","sum")
################### PCA ##############
# includes all countries (not just with 30+ papers)
## diversity of topic research
topic_diversity <- sums %>%
group_by(topic) %>%
mutate(diversity.score = diversity(sum)) %>%
select(-c("country","sum")) %>%
distinct()
pca <- merge(topic_sums, topic_diversity) # combine topic_sum with topic_diversity
# hard to differentiate between diversitiy scores
pca$diversity.score.scale <- scale(pca$diversity.score)
pca$diversity.score.log <- log(pca$diversity.score)
pca$diversity.score.exp <- exp(pca$diversity.score)
pca.graph <- ggscatter(pca, x= "diversity.score", y = "sum",
label = "topic",
label.rectangle = TRUE)
pca.graph
plotly::ggplotly(pca.graph)
View(topic_diversity)
View(country_sums)
View(sums)
pca <- merge(topic_sums, topic_diversity) # combine topic_sum with topic_diversity
pca.graph <- ggscatter(pca, x= "diversity.score", y = "sum",
label = "topic",
label.rectangle = TRUE)
pca.graph
