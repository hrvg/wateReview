filter(variable == "NSF_general") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# heat map
x2$value<-factor(x2$value,levels=c("mathematics & statistics","social sciences","engineering","life sciences","physical sciences"))
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n))
a
a <- a +
scale_fill_grey() +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a <- a +
scale_fill_grey(start = 0, end = 20) +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a <- a +
scale_fill_grey(start = 0, end = 20) +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a <- a +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a
x2 <- x %>%
filter(variable == "NSF_general") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# heat map
x2$value<-factor(x2$value,levels=c("mathematics & statistics","social sciences","engineering","life sciences","physical sciences"))
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n))
a
a <- a +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a <- a +
scale_fill_grey +
theme_pubr() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")
a
a +
scale_fill_grey() +
labs(title= "LDA coverage",
y="NSF general categories", x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = cadetblue1, high = cadetblue4) +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "cadetblue1", high = "cadetblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.7, height=0.7))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.9, height=0.9))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a +
scale_fill_gradient(low = "lightcyan", high = "lightcyan4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue14") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
plotly::ggplotly(a)
a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a<- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
plotly::ggplotly(a)
a<- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a
View(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
View(x2)
######## graphing #############
ggbarplot(x2, x = "value", y = "n",
fill = "lang",
color = "white",
palette = c("#00AFBB", "#FC4E07",  "#E7B800"),
rotate = TRUE)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF general categories",
x = "LDA for each language")+
theme_pubr()
a
plotly::ggplotly(a)
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
## need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
## need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
filter(value != "NA") %>%
group_by(value, lang) %>%
tally
View(x2)
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x2 <- na.rm(x2)
View(x)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
#filter(value != "NA") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x <- rbind(en2,es2,pt2)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
group_by(value, lang) %>%
tally
library(dplyr)
library(reshape2)
library(ggpubr)
library(tidyr)
library(ggplot2)
######## load data #############
en <- read.csv("./topic_names_en.csv")
es <- read.csv("./topic_names_es.csv")
pt <- read.csv("./topic_names_pt.csv", na.strings=c("","NA"))
en$lang <- "en"
es$lang <- "es"
pt$lang <- "pt"
en2 <- melt(en,
id.vars = c("topic_id","lang"))
es2 <- melt(es,
id.vars = c("topic_id","lang"))
pt2 <- melt(pt,
id.vars = c("topic_id","lang"))
x <- rbind(en2,es2,pt2)
x <- na.omit(x)
######## filter #############
x2 <- x %>%
filter(variable == "NSF_general") %>%
group_by(value, lang) %>%
tally
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
######## filter #############
x2 <- x %>%
filter(variable == "NSF_specific") %>%
group_by(value, lang) %>%
tally
# need to order based on engligh numbers
lvls <- as.character(x2$value[x2$lang=="en"])[order(x2$n[x2$lang=="en"])]
x2$value <- factor(x2$value, levels = lvls)
x2 <- na.omit(x2)
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.97, height=0.97))
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
a <- ggplot(data = x2, aes(x = lang, y = value)) +
geom_tile(aes(fill = n, width=0.9, height=0.9)) # edit for specific vs. general
a
a <- a +
scale_fill_gradient(low = "lightsteelblue1", high = "lightsteelblue4") +
labs(title= "LDA coverage",
y="NSF specific categories",
x = "LDA for each language")+
theme_pubr()
a
View(en)
# define subset
probs <- reduce_docs_for_JSd(specific)
probs <- probs %>% mutate(topic = replace(topic, topic == "groundwater flow", "groundwater"))
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>% # calculate proportion of research each country spends on each topic
group_by(topic) %>%
mutate(scaled = scale(prop)) %>% # scale by topic
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd_country)
names(country_distance) <- unique(df$topic)
country_distance <- as.data.frame(country_distance)
country_distance$topic <- rownames(country_distance)
setwd("~/R_code/LAC")
source("./diversity/lib_lac.R")
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
library(philentropy)
library(scales)
library(ggplotify)
library(plotly)
library(tidyr)
library(tidyverse)
################### raw files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
# define subset
probs <- reduce_docs_for_JSd(specific)
probs <- probs %>% mutate(topic = replace(topic, topic == "groundwater flow", "groundwater"))
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>% # calculate proportion of research each country spends on each topic
group_by(topic) %>%
mutate(scaled = scale(prop)) %>% # scale by topic
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd_country)
names(country_distance) <- unique(df$topic)
country_distance <- as.data.frame(country_distance)
country_distance$topic <- rownames(country_distance)
df <- probs %>%
mutate(countrytopic = paste(country,topic)) %>%
group_by(countrytopic) %>%
mutate(scaled = scale(value)) %>%
select(c("countrytopic","scaled")) # need to scale somehow?
topic_distance <- sapply(unique(df$countrytopic), get_JSd_corpus)
names(topic_distance) <- unique(df$countrytopic)
topic_distance <- as.data.frame(topic_distance)
topic_distance$countrytopic <- rownames(topic_distance)
topic_distance <- topic_distance %>%
mutate(topic = word(countrytopic, 2, -1)) %>%
group_by(topic) %>%
mutate(topic_distance = median(topic_distance)) %>%
select(c("topic","topic_distance")) %>%
distinct()
# combine and save separate csvs
distance <- merge(country_distance, topic_distance, by = "topic")
get_JSd_country('climate change impacts', plot = T)
View(probs)
probs <- reduce_docs_for_JSd(theme)
probs <- probs %>% mutate(topic = replace(topic, topic == "groundwater flow", "groundwater"))
############### across countries ###########
# calculate distance from normal for % of research done in each country
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>% # calculate proportion of research each country spends on each topic
group_by(topic) %>%
mutate(scaled = scale(prop)) %>% # scale by topic
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd_country)
names(country_distance) <- unique(df$topic)
country_distance <- as.data.frame(country_distance)
country_distance$topic <- rownames(country_distance)
############### across documents ###########
# calculate distance from normal for all documents
# MEDIAN OF JSD for EACH topic by 12 COUNTRIES
df <- probs %>%
mutate(countrytopic = paste(country,topic)) %>%
group_by(countrytopic) %>%
mutate(scaled = scale(value)) %>%
select(c("countrytopic","scaled")) # need to scale somehow?
topic_distance <- sapply(unique(df$countrytopic), get_JSd_corpus)
names(topic_distance) <- unique(df$countrytopic)
topic_distance <- as.data.frame(topic_distance)
topic_distance$countrytopic <- rownames(topic_distance)
topic_distance <- topic_distance %>%
mutate(topic = word(countrytopic, 2, -1)) %>%
group_by(topic) %>%
mutate(topic_distance = median(topic_distance)) %>%
select(c("topic","topic_distance")) %>%
distinct()
get_JSd_country('climate change impacts', plot = T)
View(probs)
sums <-aggregate(probs$value, by=list(probs$country,probs$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
df <- sums %>%
group_by(country) %>%
mutate(prop = sum/sum(sum)) %>% # calculate proportion of research each country spends on each topic
group_by(topic) %>%
mutate(scaled = scale(prop)) %>% # scale by topic
ungroup() %>%
select(c("topic","scaled"))
country_distance<- sapply(unique(df$topic), get_JSd_country)
names(country_distance) <- unique(df$topic)
country_distance <- as.data.frame(country_distance)
country_distance$topic <- rownames(country_distance)
get_JSd_country('climate change impacts', plot = T)
get_JSd_country('agriculture', plot = T)
df <- probs %>%
mutate(countrytopic = paste(country,topic)) %>%
group_by(countrytopic) %>%
mutate(scaled = scale(value)) %>%
select(c("countrytopic","scaled")) # need to scale somehow?
topic_distance <- sapply(unique(df$countrytopic), get_JSd_corpus)
names(topic_distance) <- unique(df$countrytopic)
topic_distance <- as.data.frame(topic_distance)
topic_distance$countrytopic <- rownames(topic_distance)
topic_distance <- topic_distance %>%
mutate(topic = word(countrytopic, 2, -1)) %>%
group_by(topic) %>%
mutate(topic_distance = median(topic_distance)) %>%
select(c("topic","topic_distance")) %>%
distinct()
# combine and save separate csvs
distance <- merge(country_distance, topic_distance, by = "topic")
write.csv(distance, file = "./diversity/csvs/themesdistance.csv")
ggscatter(theme, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE,
xlab = "Normality across documents",
ylab = "Normality across countries")
theme <- read.csv("./diversity/csvs/themesdistance.csv")
ggscatter(theme, y = "country_distance", x = "topic_distance",
label = "topic",
label.rectangle = TRUE,
repel = TRUE,
xlab = "Normality across documents",
ylab = "Normality across countries")
# interactive graphs
b <- ggplot(budget, aes(y = country_distance, x = topic_distance, group = topic)) + geom_point() + theme_pubr()
ggplotly(b, tooltip = c('topic'))
ggplotly(b, tooltip = c('theme'))
# interactive graphs
b <- ggplot(theme, aes(y = country_distance, x = topic_distance, group = topic)) + geom_point() + theme_pubr()
ggplotly(b, tooltip = c('topic'))
