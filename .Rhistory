<<<<<<< HEAD
print(sqrt(mean((noisy.y - y)^2)))
} else {
perf <- sapply(power, function(pow){summary(lm(noisy.y ~ poly(q,pow)))$r.squared })
print(data.frame(hyper_parameter = power, performance = signif(perf, 3)))
}
}
get_poly_model(error = 40, ML = T)
20^4
20^4 * 10
signif(20^4 * 10, 2)
signif(20^4 * 10)
signif(20^4 * 10) / 1E6
library("mlr")
lrn <- makeLearner("classif.h2o.deeplearning")
install.packages("h2o")
lrn <- makeLearner("classif.h2o.deeplearning")
getParamSet(lrn)
library("mlr")
getParamSet(makeLearner("classif.h2o.deeplearning"))
setwd("/media/hguillon/hrvg/research/exploitation/R/latin_america")
theme_df_docs <- readRDS("data/theme_df_docs.Rds")
dim(theme_df_docs)
topicDocs <- readRDS("./data/topicDocs.Rds")
dim(topicDocs)
theme_df_docs_bak <- theme_df_docs
make_df_docs <- function(theme_type){
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
theme_type <- "theme"
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
saveRDS(object = theme_df_docs, paste0("./data/", theme_type, "_df_docs.Rds"))
}
make_df_docs(theme_type = "theme")
theme_df_docs <- readRDS("data/theme_df_docs.Rds")
identical(theme_df_docs, theme_df_docs_bak)
make_df_docs(theme_type = "NSF_general")
make_df_docs <- function(theme_type){
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
saveRDS(object = theme_df_docs, paste0("./data/", theme_type, "_df_docs.Rds"))
}
make_df_docs(theme_type = "NSF_general")
theme_df_docs <- readRDS("data/NSF_general_df_docs.Rds")
dim(theme_df_docs)
head(theme_df_ddocs)
head(theme_df_docs)
rowSums(theme_df_docs)
all(rowSums(theme_df_docs) == 1)
all(rowSums(theme_df_docs) >= 1-1E16)
all(rowSums(theme_df_docs) >= 1-1E17)
all(rowSums(theme_df_docs) >= 1-1E22)
all(rowSums(theme_df_docs) >= 1-1E36)
all(rowSums(theme_df_docs) >= 1-1E50)
all(rowSums(theme_df_docs) >= 1-1E49)
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description
topic_names$description[[1]]
as.character(topic_names$description)
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names$description <- gsub("", NA, topic_names$description)
topic_names$description
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names$description[1]
make_df_docs <- function(theme_type = "theme", description = NULL){
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
}
make_df_docs(description = "methods")
theme_df_docs <- readRDS("./data/methods_df_docs.Rds")
head(theme_df_docs)
make_df_docs <- function(theme_type = "theme", description = NULL){
stopifnot(theme_type %in% c("topic_name", "theme", "NSF_specific", "NSF_general"))
if (!is.null(description)){
stopifnot(description %in% c("spatial scale", "methods", "temporal scale", "water budget"))
}
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
}
make_df_docs(theme_type = "pasta")
make_df_docs(theme_type = "theme", description = "pasta")
make_df_docs <- function(theme_type = "theme", description = NULL, save = FALSE){
stopifnot(theme_type %in% c("topic_name", "theme", "NSF_specific", "NSF_general"))
if (!is.null(description)){
stopifnot(description %in% c("spatial scale", "methods", "temporal scale", "water budget"))
}
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
if (save){
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
} else {
return(theme_df_docs)
}
}
v
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = TRUE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
theme_df_docs <- readRDS(paste0("data/", theme_type, "_df_docs.Rds"))
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
save_predCountryMembership <- function(predCountryMembership){
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
year <- in_corpus_LDA$Year
predCountry <- predCountry[-missing]
predCountryMembership <- totPred$data[-missing, colnames(predCountryMembership) != "response"]
saveRDS(predCountryMembership, "predCountryMembership.Rds")
}
make_df_docs <- function(theme_type = "theme", description = NULL, save = FALSE){
stopifnot(theme_type %in% c("topic_name", "theme", "NSF_specific", "NSF_general"))
if (!is.null(description)){
stopifnot(description %in% c("spatial scale", "methods", "temporal scale", "water budget"))
}
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
if (save){
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
} else {
return(theme_df_docs)
}
}
predCountryMembership <- readRDS("predCountryMembership.Rds")
predCountryMembership
dim(predCountryMembership)
predCountry <- colnames(predCountry)[apply(predCountryMembership, 1, which.max)]
predCountry <- colnames(predCountryMembership)[apply(predCountryMembership, 1, which.max)]
predCountry
predCountry <- gsub("prob.", "", predCountry)
head(predCountry)
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = TRUE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
get_predCountry <- function(){
predCountryMembership <- readRDS("predCountryMembership.Rds")
predCountry <- colnames(predCountryMembership)[apply(predCountryMembership, 1, which.max)]
predCountry <- gsub("prob.", "", predCountry)
}
save_predCountryMembership <- function(predCountryMembership){
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
year <- in_corpus_LDA$Year
predCountry <- predCountry[-missing]
predCountryMembership <- totPred$data[-missing, colnames(predCountryMembership) != "response"]
saveRDS(predCountryMembership, "predCountryMembership.Rds")
}
make_df_docs <- function(theme_type = "theme", description = NULL, save = FALSE){
stopifnot(theme_type %in% c("topic_name", "theme", "NSF_specific", "NSF_general"))
if (!is.null(description)){
stopifnot(description %in% c("spatial scale", "methods", "temporal scale", "water budget"))
}
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
if (save){
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
} else {
return(theme_df_docs)
}
}
predCountry <- get_predCountry()
predCountry
dim(predCountry)
length(predCountry)
dim(theme_df_docs)
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = FALSE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
consolidate_LDA_results(theme_type = "topics")
consolidate_LDA_results(theme_type = "topic_name")
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = FALSE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
titleDocs <- readLines("F:/hguillon/research/exploitation/R/latin_america/data/info.dat")
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
consolidate_LDA_results(theme_type = "topic_name")
titleDocs <- readLines("data/info.dat")
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = FALSE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
titleDocs <- readLines("data/info.dat")
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
consolidate_LDA_results(theme_type = "topic_name")
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = FALSE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
titleDocs <- readLines("data/info.dat")
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
year <- in_corpus_LDA$Year
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", theme_type, ".Rds"))
} else {
return(consolidated_results)
}
}
head(consolidate_LDA_results(theme_type = "topic_name"))
head(consolidate_LDA_results(theme_type = "NSF_general"))
head(consolidate_LDA_results(theme_type = "NSF_specific"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "methods"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "spatial scale"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "temporal scale"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "temporal scale"))
make_df_docs <- function(theme_type = "theme", description = NULL, save = FALSE){
stopifnot(theme_type %in% c("topic_name", "theme", "NSF_specific", "NSF_general"))
if (!is.null(description)){
stopifnot(description %in% c("spatial scale", "methods", "water budget"))
}
topicDocs <- readRDS("./data/topicDocs.Rds")
topic_names <- read.csv("./data/topic_names.csv")
topic_names$description <- as.character(topic_names$description)
topic_names <- topic_names[match(seq(nrow(topic_names)), topic_names$topic_id), ]
topicDocs <- as.data.frame(topicDocs)
colnames(topicDocs) <- topic_names$topic_name
if (!is.null(description)){
theme_type <- "topic_name"
themes <- unique(topic_names[[theme_type]][grepl(description, topic_names$description)])
} else {
themes <- unique(topic_names[[theme_type]][!is.na(topic_names[[theme_type]])])
}
theme_df_docs <- lapply(themes, function(th){
ind <- which(topic_names[[theme_type]] == th)
if (length(ind) == 1){
return(topicDocs[, ind])
} else {
return(rowSums(topicDocs[, ind]))
}
})
theme_df_docs <- do.call(cbind, theme_df_docs)
rownames(theme_df_docs) <- rownames(topicDocs)
colnames(theme_df_docs) <- themes
rm(topicDocs)
rSums <- rowSums(theme_df_docs)
theme_df_docs <- sweep(theme_df_docs, 1, rSums, "/")
if (save){
saveRDS(object = theme_df_docs, paste0("./data/", ifelse(is.null(description), theme_type, description), "_df_docs.Rds"))
} else {
return(theme_df_docs)
}
}
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "temporal scale"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "spatial scale"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "water budget"))
head(consolidate_LDA_results(theme_type = "NSF_specific", description = "methods"))
consolidate_LDA_results(theme_type = "theme", save = TRUE)
consolidate_LDA_results(theme_type = "NSF_general", save = TRUE)
consolidate_LDA_results(theme_type = "NSF_specific", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "water budget", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "methods", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "spatial scale", save = TRUE)
consolidate_LDA_results <- function(theme_type = "theme", description = NULL, save = FALSE){
theme_df_docs <- make_df_docs(theme_type = theme_type, description = description)
in_corpus_file <- "in_corpus.Rds"
in_corpus <- readRDS(in_corpus_file)
EndNoteIdcorpus <- unname(sapply(in_corpus$pdfs, substr, start = 1, stop = 10))
titleDocs <- readLines("data/info.dat")
EndNoteIdLDA <- unname(sapply(titleDocs, substr, start = 1, stop = 10))
in_corpus_LDA <- in_corpus[which(EndNoteIdcorpus %in% EndNoteIdLDA), ]
missing <- which(! EndNoteIdLDA %in% EndNoteIdcorpus)
theme_df_docs <- theme_df_docs[-missing, ]
year <- in_corpus_LDA$Year
consolidated_results <- data.frame(year = year, country = as.character(predCountry))
consolidated_results <- cbind(theme_df_docs, consolidated_results)
if (save){
saveRDS(consolidated_results, paste0("consolidated_results_", ifelse(is.null(description), theme_type, description), ".Rds"))
} else {
return(consolidated_results)
}
}
consolidate_LDA_results(theme_type = "theme", save = TRUE)
consolidate_LDA_results(theme_type = "NSF_general", save = TRUE)
consolidate_LDA_results(theme_type = "NSF_specific", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "water budget", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "methods", save = TRUE)
consolidate_LDA_results(theme_type = "theme", description = "spatial scale", save = TRUE)
=======
theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
risk <- df
View(risk)
colnames(c("country","risk"))
colnames(risk,c("country","risk"))
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggdotchart(df2,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
risk <- df
# combine
risk_country <- df
risk_yar <- df2
View(risk_country)
View(risk_yar)
topic_pick <- "risk assessment"
theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
df2<- aggregate(df2$value, by=list(df2$year), FUN=sum)
ggdotchart(df,
x= "Group.1", y = "x",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
# combine
risk_country <- df
risk_yar <- df2
View(risk)
topic_pick <- "climate change impacts"
theme_topic <- remove_irrelevant(methods) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
theme_topic <- remove_irrelevant(theme) # define correct data frame
theme_topic <- melt(theme_topic,
id.vars = c("year","country"))
theme_topic <- subset(theme_topic, variable == topic_pick)
# sum by country
df <- theme_topic %>%
select(-c("year","variable"))
df<- aggregate(df$value, by=list(df$country), FUN=sum)
# sum by year
df2 <- theme_topic %>%
select(-c("country","variable"))
df2<- aggregate(df2$value, by=list(df2$year), FUN=sum)
climate_country <- df
climate_year <- df2
View(climate_year)
df <-cbind(risk_country, climate_country)
View(df)
df <- df %>%
rename(Group.1 = country, x = risk)
names(df)[2]<-"risk"
names(df)[4]<-"climate"
names(df)[4]<-"climate change impacts"
df2 <-cbind(risk_yar, climate_year)
names(df2)[2]<-"risk assessment"
names(df2)[4]<-"climate change impacts"
View(df2)
df[3] <- NULL    # Wojciech Sobala
df2[3] <- NULL
df <- melt(df,
id.vars = Group.1)
df <- melt(df,
id.vars = "Group.1")
df <-cbind(risk_country, climate_country)
names(df)[2]<-"risk assessment"
names(df)[4]<-"climate change impacts"
df2 <-cbind(risk_yar, climate_year)
names(df2)[2]<-"risk assessment"
names(df2)[4]<-"climate change impacts"
df[3] <- NULL
df2[3] <- NULL
df <- melt(df,
id.vars = "Group.1")
df2 <- melt(df2,
id.vars = "Group.1")
ggdotchart(df,
x= "Group.1", y = "value", color = "variable"
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "value", color = "variable",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x, color = "variable")) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggplot(df2, aes(x = Group.1, y = x, color = variable)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggplot(df2, aes(x = Group.1, y = value, color = variable)) +
geom_area() +
theme_pubr() +
labs(title = topic_pick)
ggdotchart(df,
x= "Group.1", y = "value", color = "variable",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick)
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
theme_country <- subset(theme, country == country_pick)
################### ideas #########################
# calculate diversity index
# community = location:
# each paper, all papers in each country, all papers in country clusters, all papers in LAC
# species = topics:
# NSF gemeral, NSF specific, theme, theme subsets, specific theme
# species population = probability or sum of probability
# GOAL:
output <- as.data.frame(unique(res$country))
output <- output %>%
rename(community = `unique(res$country)`) %>%
mutate(nsfgeneral = 0) %>%
mutate(nsfspecific = 0) %>%
mutate(theme = 0) %>%
mutate(themesubset = 0) %>%
mutate(themespecific = 0)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
################### functions #########################
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
sum_country <- function(df) {
sumdf <- data.frame(value=apply(df,2,sum))
sumdf$key=rownames(sumdf)
return(sumdf)
}
country_pick <- "Mexico"
theme_country <- subset(theme, country == country_pick)
View(theme_country)
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
theme_country3 <- remove_country(theme_country)
theme_country2 <- remove_year_country(theme_country)
theme_country2 <- sum_country(theme_country2)
View(theme_country2)
theme_country3 <- remove_country(theme_country)
View(theme_country3)
View(theme_country3)
theme_country3 <- melt(theme_country3,
id.vars = "year")
View(theme_country3)
theme_country3 <- theme_country3 %>%
select(-c("year"))
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
theme_country3 <- theme_country3 %>%
select(-c("variable"))
theme_country3<- aggregate(theme_country3$value, by=list(theme_country3$year), FUN=sum)
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
theme_country3 <- theme_country3 %>%
select(-c("variable"))
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
# theme_country3 <- theme_country3 %>%
#select(-c("variable"))
theme_country3<- aggregate(theme_country3$value,
by=list(theme_country3$variable,theme_country3$year),
FUN=sum)
ggline(theme_country3, x = "Group.2", y = "value", color = "Group.1")
ggline(theme_country3, x = "Group.2", y = "x", color = "Group.1")
################### ideas #########################
# calculate diversity index
# community = location:
# each paper, all papers in each country, all papers in country clusters, all papers in LAC
# species = topics:
# NSF gemeral, NSF specific, theme, theme subsets, specific theme
# species population = probability or sum of probability
# GOAL:
output <- as.data.frame(unique(res$country))
output <- output %>%
rename(community = `unique(res$country)`) %>%
mutate(nsfgeneral = 0) %>%
mutate(nsfspecific = 0) %>%
mutate(theme = 0) %>%
mutate(themesubset = 0) %>%
mutate(themespecific = 0)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
################### files #########################
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
################### functions #########################
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
sum_country <- function(df) {
sumdf <- data.frame(value=apply(df,2,sum))
sumdf$key=rownames(sumdf)
return(sumdf)
}
################### diversity analysis #########################
# calculate diversity by paper / for all of LAC
clean <- remove_year_country(general) #  specify which (species group)
diversity_LA <- diversity_LAC(clean)
diversity_paper <- diversity(clean)
# check - diveristy function from vegan package works
check <- as.data.frame(colSums(clean))
sum <- sum(check)
check$pi <- check$`colSums(clean)`/sum
check$lnpi <- log(check$pi)
check$pilnpi <- check$pi * check$lnpi
H <- -sum(check$pilnpi)
# calculate diversity by country
general2 <- remove_irrelevant(general)
specific2 <- remove_irrelevant(specific)
theme2 <- remove_irrelevant(theme)
general2 <-  diversity_country(general2)
specific2 <- diversity_country(specific2)
theme2 <- diversity_country(theme2)
diversity_by_country<-cbind(general2, specific2,theme2)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2)
fwrite(diversity_by_country, file = "./diversity/diversity by country.csv")
################### diversity graphs #########################
diversity_by_country_graph <- melt(diversity_by_country,
id.vars = c("country"))
# theme
theme_graphdf <- subset(diversity_by_country_graph, variable == "theme")
theme_graph <- ggdotchart(theme_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "theme") +
geom_hline(yintercept = diversity_LA, linetype = 2, color = "lightgray")
# NSF specific
specific_graphdf <- subset(diversity_by_country_graph, variable == "NSFspecific")
specific_graph <- ggdotchart(specific_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "specific")
# NSF general
general_graphdf <- subset(diversity_by_country_graph, variable == "NSFgeneral")
general_graph <- ggdotchart(general_graphdf, x = "country", y = "value", #add color = cluster
add = "segments", sorting = "descending", rotate = TRUE, title = "general")
theme_graph
specific_graph
general_graph
ggscatter(diversity_by_country, x = "NSFgeneral", y = "theme", color = "country")
country_pick <- "Mexico"
theme_country <- subset(theme, country == country_pick)
theme_country2 <- remove_year_country(theme_country)
theme_country2 <- sum_country(theme_country2)
theme_country3 <- remove_country(theme_country)
theme_country3 <- melt(theme_country3,
id.vars = "year")
# theme_country3 <- theme_country3 %>%
#select(-c("variable"))
theme_country3<- aggregate(theme_country3$value,
by=list(theme_country3$variable,theme_country3$year),
FUN=sum)
ggline(theme_country3, x = "Group.2", y = "x", color = "Group.1")
View(theme_country3)
View(theme_country2)
View(theme_country2)
View(theme_country3)
sum_country_by_year <- function(df) {
df<- aggregate(df$x, by=list(df$Group.2), FUN=sum)
return(sumdf)
}
sum_country_by_year <- function(df) {
df<- aggregate(df$x, by=list(df$Group.2), FUN=sum)
return(df)
}
theme_country3 <- sum_country_by_year(theme_country3)
ggline(theme_country3, x = "Group.1", y = "x")
theme_country3 <- theme_country3 %>%
select(Group.1 != 2018)
theme_country3 <- theme_country3 %>%
select(Group.1 != "2018")
theme_country3 <- subset(theme_country3, Group.1 != 2018)
ggline(theme_country3, x = "Group.1", y = "x")
theme_country3$cum  <- cumsum(theme_country3$x)
ggline(theme_country3, x = "Group.1", y = "x") # cummulative
ggline(theme_country3, x = "Group.1", y = "cum") # cummulative
ggplot(theme_country3, aes(x = Group.1)) +
ggline(y = x) =
ggline(y = cum)
ggplot(theme_country3, aes(x = Group.1)) +
ggline(y = x) +
ggline(y = cum)
ggplot(theme_country3, aes(x = Group.1)) +
ggline(aes(y = x)) +
ggline(aes(y = cum))
ggplot(theme_country3) +
ggline(aes(x = Group.1, y = x)) +
ggline(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, color = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, fill = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum, fill = green))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum))
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr()
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(x = "Number of papers")
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x)) +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers", x=NULL)
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x), linetype = "dashed") +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers", x=NULL)
ggplot(theme_country3) +
geom_line(aes(x = Group.1, y = x), linetype = "dashed") +
geom_line(aes(x = Group.1, y = cum)) +
theme_pubr() +
labs(y = "Number of papers on water in Mexico", x=NULL)
general_country <- subset(general, country == country_pick)
general_country2 <- remove_year_country(general_country)
View(general_country2)
general_country2 <- sum_country(general_country2)
pie(general_country2, labels = key, main="Pie Chart")
pie(general_country2$value, labels = general_country2$key, main="Pie Chart")
pie(general_country2$value, labels = general_country2$key, main="Distribution based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of research based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research based on NSF general categories")
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research
based on NSF general categories")
ggpie(general_country2, "value", label = "key")
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = c("#00AFBB", "#E7B800", "#FC4E07") ))
library(wesanderson)
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Chevalier1")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeelig")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeeling")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_color_manual(values = wes_palette(n=5, name ="Darjeeling1")))
ggpie(general_country2, "value", label = "key",
fill = "group", color = "white",
palette = scale_fill_manual(values = wes_palette(n=5, name ="Darjeeling1")))
ggpie(general_country2, "value", label = "key",
fill = "group",
palette = scale_fill_manual(values = wes_palette(n=5, name ="Darjeeling1")))
pie(general_country2$value, labels = general_country2$key, main="Distribution of water research
based on NSF general categories")
country_pick <- "Mexico"
View(theme)
View(theme_country)
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme)
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme_corpus)
View(theme_corpus)
theme <- readRDS("./consolidated_results_theme.Rds")
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme <- melt(theme_corpus)
View(theme)
theme <- readRDS("./consolidated_results_theme.Rds")
################### corpus analysis graphs #########################
theme_corpus <- remove_year_country(theme)
theme_corpus <- melt(theme_corpus)
>>>>>>> d2bae7c39cd12798f7e32337fa8b68882e5c2a39
