remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
# SAVE for mapping
# write.csv(sums,'./diversity/csvs/nsfspecific.csv')
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
## topic description
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
pca
## define data frame
df <- remove_year(general) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
pca
## define data frame
df <- remove_year(specific) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
pca
## topic
topic_pick <- "island and extreme weather"
## topic
topic_pick <- "island and extreme weather"
topic_total <- topic_sums$sum[topic_sums$topic == topic_pick]
View(topic)
## define data frame
df <- remove_year(specific) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
pca
## topic
topic_pick <- "island and extreme weather"
topic_total <- topic$total[topic$topic == topic_pick]
topic_total <- topic$total[topic$topic == topic_pick]
## topic
topic_pick <- "geology"
topic_total <- topic$total[topic$topic == topic_pick]
topic_subset <- subset(sums, topic == topic_pick)
topic_subset <- cbind(topic_subset, country_sums)
topic_subset <- cbind(topic_subset, country)
View(topic_subset)
View(country)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
library(ggplot2)
################### files #########################
setwd("~/R_code/LAC")
general <- readRDS("./consolidated_results_NSF_general.Rds")
specific <- readRDS("./consolidated_results_NSF_specific.Rds") # 45 themes
methods <- readRDS("./consolidated_results_methods.Rds")
budget <- readRDS("./consolidated_results_water budget.Rds")
theme <- readRDS("./consolidated_results_theme.Rds")
################### functions #########################
remove_year_country <- function(df) {
df <- df %>%
filter(country != "Irrelevant") %>%
select(-c("year","country"))
return(df)
}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_country <- function(df) {
df <- df %>%
select(-c("year"))
df <- melt(df,
id.vars = c("country"))
df <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
df <- df %>%
rename(country = Group.1, sepcies = Group.2, population = x) # species is country*topic
df <- group_by(df, country)
df <- do(df, tidy(diversity(.$population)))
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
col_sums <- function(df) {
df <- colSums(df)
df$key=rownames(df)
return(sumdf)
}
################### subject analysis  #########################
## define data frame
df <- remove_year(specific) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
# SAVE for mapping
# write.csv(sums,'./diversity/csvs/nsfspecific.csv')
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
## topic description
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
pca
View(country)
View(topic_subset)
topic_subset <- subset(sums, topic == topic_pick)
View(topic_subset)
View(country)
topic_subset <- cbind(topic_subset, country)
topic_subset <- subset(sums, topic == topic_pick)
View(topic_subset)
?cbind
topic_subset <- merge(topic_subset, country)
topic_subset$perc <- topic_subset$sum / topic_subset$total * 100
ggdotchart(topic_subset,
x= "country", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick) +
xlab(NULL) +
ylab("Percent of research on topic")
View(country)
View(country_sums)
## country
country_pick <- "Mexico"
country_total <- country_sums$no.papers[country_sums$country == country_pick]
country_subset <- subset(sums, country == country_pick)
View(country_subset)
View(topic)
country_subset <- cbind(country_subset, topic)
country_subset <- subset(sums, country == country_pick)
country_subset <- merge(country_subset, topic)
country_subset$perc <- country_subset$sum / country_subset$total * 100
country_subset$rel <- country_subset$sum / country_total
ggdotchart(country_subset,
x= "topic", y = "rel",
rotate = TRUE, add = "segments", sorting = "descending",
title = country_pick) +
xlab(NULL) +
ylab("Probability research is on each topic")
ggdotchart(country_subset,
x= "topic", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = country_pick) +
xlab(NULL) +
ylab("Probability research is on each topic")
country_subset <- subset(sums, country == country_pick)
country_subset <- merge(country_subset, topic)
country_subset$perc <- country_subset$sum / country_subset$total * 100
30/137
ggdotchart(country_subset,
x= "topic", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = country_pick) +
xlab(NULL) +
ylab("Probability research is on each topic")
## define data frame
df <- remove_year(budget) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
## topic
topic_pick <- "rivers"
topic_total <- topic$total[topic$topic == topic_pick]
topic_subset <- subset(sums, topic == topic_pick)
topic_subset <- merge(topic_subset, country)
topic_subset$perc <- topic_subset$sum / topic_subset$total * 100
ggdotchart(topic_subset,
x= "country", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick) +
xlab(NULL) +
ylab("Percent of research on topic")
## topic
topic_pick <- "glaciers"
topic_total <- topic$total[topic$topic == topic_pick]
topic_subset <- subset(sums, topic == topic_pick)
topic_subset <- merge(topic_subset, country)
topic_subset$perc <- topic_subset$sum / topic_subset$total * 100
ggdotchart(topic_subset,
x= "country", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick) +
xlab(NULL) +
ylab("Percent of research on topic")
## define data frame
df <- remove_year(methods) # pick data to work with
df <- remove_irrelevant(df)
df <- melt(df, id.vars = "country")
## count # papers per country
sums <- aggregate(df$value, by=list(df$country,df$variable), FUN=sum)
names(sums) = c("country","topic","sum")
country_sums <- aggregate(sums$sum, by=list(sums$country), FUN=sum) # no. papers per country
names(country_sums) = c("country","no.papers")
remove <- as.data.frame(country_sums$country[country_sums$no.papers < 30]) # list countries w/ < 30 papers
keep <- as.data.frame(country_sums$country[country_sums$no.papers > 30])
## subset countries with > 30 papers
df<- subset(df, df$country %in% keep$`country_sums$country[country_sums$no.papers > 30]`)
names(df) = c("country","topic","value")
## summarize country x topic
sums <-aggregate(df$value, by=list(df$country,df$topic), FUN=sum) # re - summarize after removing countries w/ < 30 papers
names(sums) = c("country","topic","sum")
## country description
country <- df %>%
group_by(country) %>%
mutate(total = sum(value)) %>% # total = # of papers
select(-c("topic","value")) %>%
distinct()
topic <- df %>% # uses df of individual papers
select(-c("country")) %>%
group_by(topic) %>%
mutate(total = sum(value)) %>%
mutate(sd = sd(value)) %>%
mutate(mean = mean(value)) %>%
mutate(var = var(value)) %>%
mutate(cv = sd/mean) %>%
select(-c("value")) %>%
distinct()
topic$prop <- topic$total/sum(topic$total)
topic_other<- sums %>% # use sums df
group_by(topic) %>%
mutate(total = sum(sum)) %>%
mutate(sd = sd(sum)) %>%
mutate(mean = mean(sum)) %>%
mutate(var = var(sum)) %>%
mutate(cv = sd/mean) %>%
select(-c("country","sum")) %>%
distinct()
topic_other$prop <- topic_other$total/sum(topic_other$total)
pca <- ggscatter(topic, x= "prop", y = "var",
label = "topic",
label.rectangle = TRUE,
repel = TRUE
)
## topic
topic_pick <- "water sampling"
topic_total <- topic$total[topic$topic == topic_pick]
topic_subset <- subset(sums, topic == topic_pick)
topic_subset <- merge(topic_subset, country)
topic_subset$perc <- topic_subset$sum / topic_subset$total * 100
ggdotchart(topic_subset,
x= "country", y = "perc",
rotate = TRUE, add = "segments", sorting = "descending",
title = topic_pick) +
xlab(NULL) +
ylab("Percent of research on topic")
