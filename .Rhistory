}
remove_year <- function(df) {
df <- df %>%
select(-c("year"))
return(df)
}
remove_country <- function(df) {
df <- df %>%
select(-c("country"))
return(df)
}
remove_irrelevant <- function(df) {
df <- df %>%
filter(country != "Irrelevant")
return(df)
}
diversity_LAC <- function(df) {
df <- colSums(df)
df <- diversity(df)
return(df)
}
sum_country <- function(df) {
sumdf <- data.frame(value=apply(df,2,sum))
sumdf$key=rownames(sumdf)
return(sumdf)
}
sum_country_by_year <- function(df) {
df<- aggregate(df$x, by=list(df$Group.2), FUN=sum)
return(df)
}
# calculate diversity by paper / for all of LAC
clean <- remove_year_country(general) #  specify which (species group)
diversity_LA <- diversity_LAC(clean)
diversity_paper <- diversity(clean)
# calculate diversity by country
general2 <- remove_irrelevant(general)
specific2 <- remove_irrelevant(specific)
theme2 <- remove_irrelevant(theme)
general2 <-  diversity_country(general2)
# calculate diversity by country
general2 <- remove_irrelevant(general)
library('tidyr')
install.packages("tidyverse")
library('tidyverse')
general2 <-  diversity_country(general2)
diversity_by_country<-cbind(general2, specific2,theme2)
diversity_by_country<-cbind(general2, specific2,theme2)
View(diversity_by_country)
diversity_by_country <- diversity_by_country %>%
select(-c("country1","country2")) %>%
rename(NSFgeneral = x, NSFspecific = x1, theme = x2)
general <- readRDS("./consolidated_results_NSF_general.Rds")
View(general)
general <- general[-c("country")]
general <- subset(general, select = -c("country"))
general <- subset(general, select = -c(country))
pivot <- tapply(general$year, sum)
library(lattice)
barley
names(general)
general_long <- gather(general, topic, prop, general$`physical sciences`:general$`social sciences`, factor_key = TRUE)
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
View(general_long)
pivot <- tapply(general_long$year, sum)
barley
pivot <- tapply(general_long$year, sum)
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
View(general_long)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
View(pivot)
library(viridis)
library(hrbrthemes)
install.packages(hrbrthemes)
################### chronological analysis #########################
library(viridis)
library(hrbrthemes)
row.names(pivot)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
################### libraries #########################
library(dplyr)
library(vegan)
library(broom)
library(reshape2)
library(ggpubr)
library(data.table)
library(wesanderson)
install.packages(tidyr)
install.packages("tidyr")
library(tidyr)
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
row.names(pivot)
library(data.table)
setDT(pivot, keep.rownames = TRUE)[]
typeof
typeof(pivot)
rows <- row.names(pivot)
pivot <- cbind(rows, pivot)
rownames(pivot) <- NULL
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot %>%
mutate(Date = as.Date(years)) %>%
complete(years = seq.Date(min(years), max(years), by="year"))
pivot <- as.data.frame(pivot)
pivot %>%
mutate(Date = as.Date(years)) %>%
complete(years = seq.Date(min(years), max(years), by="year"))
pivot %>%
mutate(years = as.Date(years)) %>%
complete(years = seq.Date(min(years), max(years), by="year"))
pivot <- fill(pivot, years)
pivot$years = as.Date(pivot$years, "%Y")
pivot$years
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = as.Date(pivot$years, "%y")
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot <- complete(years)
year = c(2000,2001,2002)
typesof(year[1])
typeof(year[1])
typeof(pivot$years)
typeof(pivot$years[1])
typeof(pivot$`physical sciences`[1])
pivot <- expand(pivot, years)
pivot$years = full_seq(pivot$years, period = 1)
typeof(pivot$years)
c(2,3,4,5,6)
typeof(c(2,3,4,5,5))
as.double(pivot$years)
pivot$years = as.double(pivot$years)
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply( prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = as.double(pivot$years)
View(pivot)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = as.integer(pivot$years)
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
typeof(pivot$years[1])
pivot$years[1]
strtoi(pivot$years)
pivot$years = strtoi(pivot$years)
pivot$years = full_seq(pivot$years, period = 1)
pivot <- pivot[-c(3:5)]
pivot <- pivot[-c(2)]
complete(pivot, `social sciences`, years = full_seq(years, period = 1), fill = list(`social sciences` = 0))
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot, `social sciences`,
years = full_seq(years, period = 1),
fill = list(`physical sciences` = 0, `life sciences` = 0, `mathematics and statistics`=0,engineering=0))
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot, years,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics and statistics`=0,engineering=0))
years <- pivot$years
years
complete(years)
full_seq(years, period = 1)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics and statistics`=0,engineering=0))
pivot[:,2:6]
pivot[2:6]
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(pivot[2:6]=0))
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(pivot[2]=0,pivot[3]=0,pivot[4]=0,pivot[5]=0,pivot[6]=0))
pivot[2]
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot %>%
cbind(years, pivot)
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot %>%
cbind(years, pivot)
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with (general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
pivot <- as.data.frame(pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics and statistics`=0,engineering=0))
pivot[is.na(pivot)] = 0
pivot[2] <- as.numeric(pivot[2])
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
View(pivot)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
View(pivot)
View(pivot)
typeof(pivot[2])
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind(years, pivot)
typeof(pivot[2])
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
typeof(pivot[2])
typeof(pivot[2][2])
pivot[2]
pivot[2][2]
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics and statistics`=0,engineering=0))
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics & statistics`=0,engineering=0))
pivot_long <- gather(pivot, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
View(pivot_long)
ggplot(pivot, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_fill_viridis(discrete = T) +
theme_ipsum() +
ggtitle("Topics over time")
library(ggplot2)
ggplot(pivot, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_fill_viridis(discrete = T) +
theme_ipsum() +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_fill_viridis(discrete = T) +
theme_ipsum() +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='log10') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
# scale_y_continuous(trans='log10') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
# scale_y_continuous(trans='log10') +
scale_fill_viridis(discrete = T, trans="pseudo_log") +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
pivot["2019"]
pivot["2018"]
pivot[c(2018)]
pivot[c("2018")]
pivot[!(row.names(pivot) %in% 2019),]
pivot <- pivot[!(row.names(pivot) %in% 2018),]
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- subset(general, select = -c(country))
general_long <- gather(general, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
pivot <- pivot[!(row.names(pivot) %in% 2018),]
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1),
fill = list(`social sciences` = 0, `physical sciences` = 0, `life sciences` = 0, `mathematics & statistics`=0,engineering=0))
pivot_long <- gather(pivot, topic, prop, 'physical sciences':'social sciences', factor_key = TRUE)
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
# scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log', labels = comma) +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_y_continuous(labels = comma) +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_y_continuous(labels = 'comma') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
general <- readRDS("./consolidated_results_NSF_general.Rds")
View(general)
general <- general[-1:2]
general <- general[-1:-2]
general <- readRDS("./consolidated_results_NSF_general.Rds")
rownames(pivot) %in%
s
general[-1:-2]
general <- readRDS("./consolidated_results_NSF_general.Rds")
head(general[-1])
head(general[-2])
general <- readRDS("./consolidated_results_NSF_general.Rds")
head(general[5:6])
general <- readRDS("./consolidated_results_NSF_general.Rds")
head(general[6:7])
general <- general[6:7]
general <- remove_irrelevant(general)
pivot <- with(general, tapply(prop, list(year, country), sum))
pivot <- with(general, tapply(country, list(year), count))
count(c(1,2,3,4,5))
x <- c(1,2,3,4,5)
length(x)
pivot <- with(general, tapply(country, list(year), length))
pivot(head)
head(pivot)
type(pivot)
show(pivot)
pivot <- pivot[!(row.names(pivot) %in% 2018)]
show(pivot)
pivot <- with(general, tapply(country, list(year, country), length))
View(pivot)
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1))
pivot_long <- gather(pivot, topic, prop, Argentina:Venezuela, factor_key = TRUE)
View(pivot_long)
ggplot(pivot, aes(x=years, y=prop, fill=topic)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=country)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
pivot_long <- gather(pivot, country, prop, Argentina:Venezuela, factor_key = TRUE)
ggplot(pivot_long, aes(x=years, y=prop, fill=country)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- general[6:7]
general <- remove_irrelevant(general)
pivot <- with(general, tapply(country, list(year, country), length))
pivot <- pivot[!(row.names(pivot) %in% 2018)]
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- general[6:7]
general <- remove_irrelevant(general)
pivot <- with(general, tapply(country, list(year, country), length))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot <- pivot[!(row.names(pivot) %in% 2018)]
pivot <- pivot[!which(pivot$years == 2018)]
pivot$years
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- general[6:7]
general <- remove_irrelevant(general)
pivot <- with(general, tapply(country, list(year, country), length))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot$years
which(pivot$years == 2018)
pivot[which(pivot$years == 2018)]
pivot$years[which(pivot$years == 2018)]
pivot <- with(general_long, tapply(prop, list(year, topic), sum))
pivot <- pivot[!(pivot$years %in% 2018)]
general <- readRDS("./consolidated_results_NSF_general.Rds")
general <- general[6:7]
general <- remove_irrelevant(general)
pivot <- with(general, tapply(country, list(year, country), length))
years <- row.names(pivot)
rownames(pivot) <- NULL
pivot <- cbind.data.frame(years, pivot)
pivot <- pivot[!(pivot$years %in% 2018)]
pivot <- pivot[!(pivot$years == 2018)]
pivot <- pivot[!(pivot$years == 2018),]
pivot$years = strtoi(pivot$years)
pivot <- complete(pivot,
years = full_seq(years, period = 1))
pivot_long <- gather(pivot, country, prop, Argentina:Venezuela, factor_key = TRUE)
ggplot(pivot_long, aes(x=years, y=prop, fill=country)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Topics over time")
ggplot(pivot_long, aes(x=years, y=prop, fill=country)) +
geom_area(alpha=0.6 , size=.5, colour="white") +
scale_y_continuous(trans='pseudo_log') +
scale_fill_viridis(discrete = T) +
ggtitle("Countries over time")
