<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clustering analysis • wateReview</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clustering analysis">
<meta property="og:description" content="wateReview">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wateReview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/wateReview.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Material and methods</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Corpus collection</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/making_query.html">Making the online query</a>
        </li>
        <li>
          <a href="../articles/query_processing.html">Query processing</a>
        </li>
        <li>
          <a href="../articles/query_QA.html">Query QA/QC</a>
        </li>
        <li>
          <a href="../articles/manual_download.html">Manually downloading corpus documents</a>
        </li>
        <li>
          <a href="../articles/select_human_reading.html">Selecting documents for human-reading</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Topic Model</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/topic_model.html">Topic model</a>
        </li>
        <li>
          <a href="../articles/lda_model.html">Running LDA</a>
        </li>
        <li>
          <a href="../articles/get_vocab.html">Getting vocabulary</a>
        </li>
        <li>
          <a href="../articles/lda_vis.html">Visualizing LDA results</a>
        </li>
        <li>
          <a href="../articles/validation.html">Validation</a>
        </li>
        <li>
          <a href="../articles/LDA_comparison.html">Comparing LDA models</a>
        </li>
        <li>
          <a href="../articles/endnote_processing.html">Cross-walk between LDA and EndNote databases</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Metadata mining</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/web_scrapping.html">web_scrapping</a>
        </li>
        <li>
          <a href="../articles/metadata_mining.html">metadata_mining</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Location predictions</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/text_mining.html">text_mining</a>
        </li>
        <li>
          <a href="../articles/webscrapped_training_labels.html">webscrapped_training_labels</a>
        </li>
        <li>
          <a href="../articles/ML_predictions.html">ML_predictions</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Socio-hydrologic clusters</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/clustering_analysis.html">Clustering analysis</a>
        </li>
        <li>
          <a href="../articles/cluster_map.html">Cluster map</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Electronic survey</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/get_emails.html">Mining email addresses</a>
        </li>
        <li>
          <a href="../articles/survey_stats.html">Survey statistics</a>
        </li>
      </ul>
</li>
    <li class="divider">
    <li class="dropdown-header">Analysis</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Research volume</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/timelines.html">Growth through time</a>
        </li>
        <li>
          <a href="../articles/chord_diagrams.html">Chord diagrams</a>
        </li>
        <li>
          <a href="../articles/country_colors.html">Colors of country flags</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Research spread</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/country_entropy.html">Country entropy</a>
        </li>
        <li>
          <a href="../articles/normality.html">Normality</a>
        </li>
        <li>
          <a href="../articles/hexagonal_maps.html">Hexagonal maps</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Connectivity</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/citation_network.html">Citation network</a>
        </li>
        <li>
          <a href="../articles/network_visualization.html">Network visualization</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clustering analysis</h1>
            
      
      
      <div class="hidden name"><code>clustering_analysis.Rmd</code></div>

    </div>

    
    
<div id="purpose" class="section level1">
<h1 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h1>
<p>In this vignette, we perform some quality control on the database of country socio-hydrologic descriptors. After filtering, the data are examined with a correlation analysis and a clustering analysis.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"wateReview"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ggplot2"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"factoextra"</span>)
<span class="co">#&gt; Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"clValid"</span>)
<span class="co">#&gt; Loading required package: cluster</span></pre></body></html></div>
</div>
<div id="loading-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h1>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">countries_shapefile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/join_database_shapefile.html">join_database_shapefile</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/read_countries_database.html">read_countries_database</a></span>(), <span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/read_countries_shapefile.html">read_countries_shapefile</a></span>())
<span class="no">att_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">countries_shapefile</span>)[-<span class="fl">1</span>]</pre></body></html></div>
</div>
<div id="visualizing-attributes" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-attributes" class="anchor"></a>Visualizing attributes</h1>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">l.att_map</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">countries_shapefile</span>)[-<span class="fl">1</span>], <span class="no">make_map</span>)
<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">l.att_map</span>, <span class="fl">1</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; Linking to GEOS 3.7.1, GDAL 2.2.2, PROJ 4.9.2</span></pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/make_maps-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">l.att_hist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">countries_shapefile</span>)[-<span class="fl">1</span>], <span class="no">make_hist</span>)
<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">l.att_hist</span>, <span class="fl">1</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; Warning: Removed 5 rows containing non-finite values (stat_density).</span></pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/make_hists-1.png" width="672"></p>
</div>
<div id="qaqc-on-country-database" class="section level1">
<h1 class="hasAnchor">
<a href="#qaqc-on-country-database" class="anchor"></a>QA/QC on country database</h1>
<p>Let’s rescale the data using the <code>make_corrmatrix</code> function with <code>rescale = TRUE</code>. The <code>missmap()</code> function the <code>Amelia</code> package then displays the missing values in the resulting rescaled <code>data.frame</code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">rescaled_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/make_corrmatrix.html">make_corrmatrix</a></span>(<span class="kw">corr_type</span> <span class="kw">=</span> <span class="st">"spearman"</span>, <span class="kw">rescale</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">.plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">rescaled_data</span>) <span class="kw">&lt;-</span> <span class="no">countries_shapefile</span>$<span class="no">COUNTRY</span>
<span class="kw pkg">Amelia</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Amelia/man/missmap.html">missmap</a></span>(<span class="no">rescaled_data</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/data%20rescaling-1.png" width="672"></p>
<p>Some predictors are missing only in some countries. We now try to identify the best set of predictors and countries by counting the number of <code>NA</code> with <code><a href="https://rdrr.io/pkg/wateReview/man/count_nas.html">count_nas()</a></code> and varying the threshold of number of <code>NA</code> per countries.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">count_nas_col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">rescaled_data</span>, <span class="kw">MARGIN</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">count_nas</span>)
<span class="no">count_nas_row</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">rescaled_data</span>, <span class="kw">MARGIN</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">count_nas</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">count_nas_row</span>) <span class="kw">&lt;-</span> <span class="no">countries_shapefile</span>$<span class="no">COUNTRY</span>
<span class="no">na_thresholds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">count_nas_row</span>), <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">list_count_nas_col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">na_thresholds</span>, <span class="kw">function</span>(<span class="no">na_threshold</span>){
    <span class="no">filtered_data</span> <span class="kw">&lt;-</span> <span class="no">rescaled_data</span>[<span class="no">count_nas_row</span> <span class="kw">&lt;=</span> <span class="no">na_threshold</span>, ]
    <span class="no">current_count_nas_col</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">filtered_data</span>, <span class="kw">MARGIN</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">count_nas</span>) <span class="co"># columns</span>
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">current_count_nas_col</span>)
})
<span class="no">count_nas_col_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">cbind</span>, <span class="no">list_count_nas_col</span>)
<span class="no">list_country_left</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">na_thresholds</span>, <span class="kw">function</span>(<span class="no">na_threshold</span>){
    <span class="no">filtered_data</span> <span class="kw">&lt;-</span> <span class="no">rescaled_data</span>[<span class="no">count_nas_row</span> <span class="kw">&lt;=</span> <span class="no">na_threshold</span>, ]
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">filtered_data</span>))
})
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">1</span>))
<span class="kw pkg">oce</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/oce/man/imagep.html">imagep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">count_nas_col_df</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="kw pkg">oce</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/oce/man/oceColorsViridis.html">oce.colorsViridis</a></span>(), <span class="kw">decimate</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"NA threshold"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Country descriptors"</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">list_country_left</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"NA threshold"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Number of countries left"</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/optimum%20set%20of%20descriptors-1.png" width="672"></p>
<p>Based on this visualization, we filter the country descriptors and drop the countries with missing values. Notice that these removed countries correspond to Carribean nations.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">drops</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"variability"</span>, <span class="st">"surface_withdrawl"</span>, <span class="st">"ground_withdrawl"</span>, <span class="st">"SPI..2017."</span>, <span class="st">"SPI_basic_human"</span>, <span class="st">"SPI_found"</span>, <span class="st">"SPI_opp"</span>)
<span class="no">rescaled_data</span> <span class="kw">&lt;-</span> <span class="no">rescaled_data</span>[, !<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">rescaled_data</span>) <span class="kw">%in%</span> <span class="no">drops</span>]
<span class="no">count_nas_row</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">rescaled_data</span>, <span class="kw">MARGIN</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">count_nas</span>) <span class="co"># lines</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">rescaled_data</span>) <span class="kw">&lt;-</span> <span class="no">countries_shapefile</span>$<span class="no">COUNTRY</span>
<span class="co"># countries left</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">rescaled_data</span>[<span class="no">count_nas_row</span> <span class="kw">&lt;=</span> <span class="fl">0</span>, ])
<span class="co">#&gt;  [1] "Argentina"          "Belize"             "Bolivia"           </span>
<span class="co">#&gt;  [4] "Brazil"             "Chile"              "Colombia"          </span>
<span class="co">#&gt;  [7] "Costa Rica"         "Cuba"               "Dominican Republic"</span>
<span class="co">#&gt; [10] "Ecuador"            "El Salvador"        "Guatemala"         </span>
<span class="co">#&gt; [13] "Guyana"             "Honduras"           "Jamaica"           </span>
<span class="co">#&gt; [16] "Mexico"             "Nicaragua"          "Panama"            </span>
<span class="co">#&gt; [19] "Paraguay"           "Peru"               "Suriname"          </span>
<span class="co">#&gt; [22] "Uruguay"            "Venezuela"</span>
<span class="co"># countries removed</span>
<span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="no">countries_shapefile</span>$<span class="no">COUNTRY</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">rescaled_data</span>[<span class="no">count_nas_row</span> <span class="kw">&lt;=</span> <span class="fl">0</span>, ]))
<span class="co">#&gt;  [1] "Antigua and Barbuda"            "Bahamas"                       </span>
<span class="co">#&gt;  [3] "Barbados"                       "Dominica"                      </span>
<span class="co">#&gt;  [5] "Grenada"                        "Haiti"                         </span>
<span class="co">#&gt;  [7] "St. Kitts and Nevis"            "St. Lucia"                     </span>
<span class="co">#&gt;  [9] "St. Vincent and the Grenadines" "Trinidad and Tobago"</span>
<span class="no">filtered_data</span> <span class="kw">&lt;-</span> <span class="no">rescaled_data</span>[<span class="no">count_nas_row</span> <span class="kw">&lt;=</span> <span class="fl">0</span>, ]
<span class="kw pkg">Amelia</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Amelia/man/missmap.html">missmap</a></span>(<span class="no">filtered_data</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/filtering%20data-1.png" width="672"></p>
</div>
<div id="correlation-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#correlation-analysis" class="anchor"></a>Correlation analysis</h1>
<p>We can now calculate the correlations and distance matrices for all types of data.</p>
<div id="pearsons-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#pearsons-correlations" class="anchor"></a>Pearson’s correlations</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">filtered_data</span>)
<span class="no">correlations</span> <span class="kw">&lt;-</span> <span class="kw pkg">Hmisc</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/rcorr.html">rcorr</a></span>(<span class="no">mat</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"pearson"</span>)
<span class="no">correlations</span>$<span class="no">r</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">correlations</span>$<span class="no">P</span> <span class="kw">&gt;</span> <span class="fl">0.05</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">correlations</span>$<span class="no">r</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"upper"</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/pearsons-1.png" width="672"></p>
</div>
<div id="spearmans-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#spearmans-correlations" class="anchor"></a>Spearman’s correlations</h2>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">filtered_data</span>)
<span class="no">correlations</span> <span class="kw">&lt;-</span> <span class="kw pkg">Hmisc</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/rcorr.html">rcorr</a></span>(<span class="no">mat</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"spearman"</span>)
<span class="no">correlations</span>$<span class="no">r</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">correlations</span>$<span class="no">P</span> <span class="kw">&gt;</span> <span class="fl">0.05</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">correlations</span>$<span class="no">r</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"upper"</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/spearmans-1.png" width="672"></p>
</div>
<div id="distance-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#distance-matrices" class="anchor"></a>Distance matrices</h2>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">distance</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/dist.html">get_dist</a></span>(<span class="no">filtered_data</span> )
<span class="no">p_dist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/dist.html">fviz_dist</a></span>(<span class="no">distance</span>, <span class="kw">gradient</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">low</span> <span class="kw">=</span> <span class="st">"steelblue"</span>,  <span class="kw">high</span> <span class="kw">=</span> <span class="st">"white"</span>), <span class="kw">order</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">p_dist</span></pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/distance_matrix-1.png" width="672"></p>
</div>
</div>
<div id="clustering-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering-analysis" class="anchor"></a>Clustering analysis</h1>
<p>Countries in the study area are clustered in relation with socio-hydrologic variables. Two methods of clustering are used: <span class="math inline">\(k\)</span>-means clustering <span class="citation">(Hartigan and Wong 1979)</span> and hierarchical clustering <span class="citation">(Murtagh 1983)</span>. The clustering is performed with Euclidian distances and following Ward’s criterion. The optimal number of clusters is investigated by evaluating the evolution with the number of clusters of the total within sums of square and of the average silhouette width <span class="citation">(Rousseeuw 1987)</span>. In addition, the following four validation metrics are used to assess the stability of the clustering under the complete set of clustering variables and a iterative procedure where one variable is removed from the set, an approach akin to leave-one-out cross-validation:</p>
<ol style="list-style-type: decimal">
<li>the average proportion of (APN) measures the proportion of observations not placed in the same cluster under both cases and evalutes how robust are the clusters under cross-validation <span class="citation">(Datta and Datta 2003)</span>;</li>
<li>the average distance between means (ADM) measures the variation of the cluster center and evaluates the stability of the localization of the cluster in the multi-dimensional clustering variable space <span class="citation">(Datta and Datta 2003)</span>;</li>
<li>average distance (AD) measures the distance between observations placed in the same cluster and evaluates within-cluster stability <span class="citation">(Datta and Datta 2003)</span>;</li>
<li>the figure of merit (FOM) estimates the predictive power of the clustering algorithm by measuring the within-cluster variance of the removed variable <span class="citation">(Yeung, Haynor, and Ruzzo 2001)</span>.</li>
</ol>
<p>Both clustering methods yield similar results. The total within sum of squares exhibits a shift in the evolution of the total within sum of square after two clusters are chosen. Similarly, the average silhouette width strongly exhibits a peak for two clusters. Further inspection of clustering in PCA dimensions indicates that the cluster with Mexico and Brazil is significantly distinct from all other countries, explaining the observation of a sharp peak in average silhouette width. However, validation metrics exhibits optimal null values of APN and ADM for two or three clusters. In addition, AD and FOM are lower for three clusters than for two. Based on this results, we chose three clusters to describe the grouping of countries based on their socio-hydrologic variables.</p>
<div id="optimum-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#optimum-clustering" class="anchor"></a>Optimum clustering</h2>
<p>We now derive the optimum clustering for <span class="math inline">\(k\)</span>-means and hierarchical clustering.</p>
<div id="k-means" class="section level3">
<h3 class="hasAnchor">
<a href="#k-means" class="anchor"></a><span class="math inline">\(k\)</span>-means</h3>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/get_optimk.html">get_optimk</a></span>(<span class="no">filtered_data</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"kmeans"</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/optimk_kmeans-1.png" width="672"></p>
</div>
<div id="hierarchical-clustering" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchical-clustering" class="anchor"></a>Hierarchical clustering</h3>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/get_optimk.html">get_optimk</a></span>(<span class="no">filtered_data</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"hierarchical"</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/optimk_hierarchical-1.png" width="672"></p>
</div>
</div>
<div id="clustering-stability" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-stability" class="anchor"></a>Clustering stability</h2>
<div id="k-means-1" class="section level3">
<h3 class="hasAnchor">
<a href="#k-means-1" class="anchor"></a><span class="math inline">\(k\)</span>-means</h3>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">cl_stability</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/clStab.html">clStab</a></span>(<span class="no">filtered_data</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"kmeans"</span>)
<span class="no">stab</span> <span class="kw">&lt;-</span> <span class="no">cl_stability</span>$<span class="no">stab</span>
<span class="no">optim_df</span> <span class="kw">&lt;-</span> <span class="no">cl_stability</span>$<span class="no">optim_df</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">stab</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Clustering Methods:</span>
<span class="co">#&gt;  kmeans </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Cluster sizes:</span>
<span class="co">#&gt;  2 3 4 5 6 7 8 9 10 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Validation Measures:</span>
<span class="co">#&gt;                  2      3      4      5      6      7      8      9     10</span>
<span class="co">#&gt;                                                                           </span>
<span class="co">#&gt; kmeans APN  0.0022 0.0000 0.0562 0.0702 0.1154 0.1833 0.1219 0.0912 0.1072</span>
<span class="co">#&gt;        AD   5.9933 5.5334 4.9773 4.5944 4.3233 4.1371 3.5719 3.1712 2.9348</span>
<span class="co">#&gt;        ADM  0.0237 0.0000 0.4368 0.3939 0.5818 1.3910 0.7739 0.5986 0.6711</span>
<span class="co">#&gt;        FOM  0.7431 0.7033 0.6818 0.6633 0.6682 0.6501 0.6389 0.6244 0.6135</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimal Scores:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Score  Method Clusters</span>
<span class="co">#&gt; APN 0.0000 kmeans 3       </span>
<span class="co">#&gt; AD  2.9348 kmeans 10      </span>
<span class="co">#&gt; ADM 0.0000 kmeans 3       </span>
<span class="co">#&gt; FOM 0.6135 kmeans 10</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Optimal Number of Cluster under One Std Rule"</span>)
<span class="co">#&gt; [1] "Optimal Number of Cluster under One Std Rule"</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">optim_df</span>)
<span class="co">#&gt;   measure cluster</span>
<span class="co">#&gt; 1     APN       2</span>
<span class="co">#&gt; 2      AD       8</span>
<span class="co">#&gt; 3     ADM       2</span>
<span class="co">#&gt; 4     FOM       7</span></pre></body></html></div>
</div>
<div id="hierarchical-clustering-1" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchical-clustering-1" class="anchor"></a>Hierarchical clustering</h3>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">cl_stability</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateReview/man/clStab.html">clStab</a></span>(<span class="no">filtered_data</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"hierarchical"</span>)
<span class="no">stab</span> <span class="kw">&lt;-</span> <span class="no">cl_stability</span>$<span class="no">stab</span>
<span class="no">optim_df</span> <span class="kw">&lt;-</span> <span class="no">cl_stability</span>$<span class="no">optim_df</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">stab</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Clustering Methods:</span>
<span class="co">#&gt;  hierarchical </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Cluster sizes:</span>
<span class="co">#&gt;  2 3 4 5 6 7 8 9 10 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Validation Measures:</span>
<span class="co">#&gt;                        2      3      4      5      6      7      8      9     10</span>
<span class="co">#&gt;                                                                                 </span>
<span class="co">#&gt; hierarchical APN  0.0000 0.0000 0.0041 0.0400 0.0505 0.0512 0.0677 0.0815 0.0828</span>
<span class="co">#&gt;              AD   5.9857 5.5736 5.1332 4.7328 4.3883 3.9961 3.6887 3.2904 3.0251</span>
<span class="co">#&gt;              ADM  0.0000 0.0000 0.0316 0.3577 0.4152 0.3476 0.4170 0.6353 0.5779</span>
<span class="co">#&gt;              FOM  0.7376 0.7056 0.7033 0.6737 0.6643 0.6493 0.6465 0.6264 0.6129</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimal Scores:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Score  Method       Clusters</span>
<span class="co">#&gt; APN 0.0000 hierarchical 2       </span>
<span class="co">#&gt; AD  3.0251 hierarchical 10      </span>
<span class="co">#&gt; ADM 0.0000 hierarchical 2       </span>
<span class="co">#&gt; FOM 0.6129 hierarchical 10</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Optimal Number of Cluster under One Std Rule"</span>)
<span class="co">#&gt; [1] "Optimal Number of Cluster under One Std Rule"</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">optim_df</span>)
<span class="co">#&gt;   measure cluster</span>
<span class="co">#&gt; 1     APN       2</span>
<span class="co">#&gt; 2      AD       7</span>
<span class="co">#&gt; 3     ADM       2</span>
<span class="co">#&gt; 4     FOM       7</span></pre></body></html></div>
</div>
</div>
<div id="cluster-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#cluster-visualization" class="anchor"></a>Cluster visualization</h2>
<div id="k-means-2" class="section level3">
<h3 class="hasAnchor">
<a href="#k-means-2" class="anchor"></a><span class="math inline">\(k\)</span>-means</h3>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">k2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span>(<span class="no">filtered_data</span>, <span class="kw">centers</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">nstart</span> <span class="kw">=</span> <span class="fl">25</span>)
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span>(<span class="no">k2</span>, <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"text"</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">filtered_data</span>) + <span class="kw pkg">cowplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>()</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/pkms-1.png" width="672"></p>
</div>
<div id="hierarchical-clustering-2" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchical-clustering-2" class="anchor"></a>Hierarchical clustering</h3>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">res.hc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eclust.html">eclust</a></span>(<span class="no">filtered_data</span>, <span class="st">"hclust"</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">graph</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span>(<span class="no">res.hc</span>, <span class="kw">rect</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="clustering_analysis_files/figure-html/phcs-1.png" width="672"></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Datta2003">
<p>Datta, Susmita, and Somnath Datta. 2003. “Comparisons and Validation of Statistical Clustering Techniques for Microarray Gene Expression Data.” <em>Bioinformatics</em> 19 (4). Oxford University Press: 459–66.</p>
</div>
<div id="ref-Hartigan1979">
<p>Hartigan, J. A., and M. A. Wong. 1979. “A K-means Clustering Algorithm.” <em>Journal of the Royal Statistical Society. Series C (Applied Statistics)</em> 28 (1): 100–108. <a href="http://www.jstor.org/stable/2346830?origin=JSTOR-pdf" class="uri">http://www.jstor.org/stable/2346830?origin=JSTOR-pdf</a>.</p>
</div>
<div id="ref-Murtagh1983">
<p>Murtagh, Fionn. 1983. “A Survey of Recent Advances in Hierarchical Clustering Algorithms.” <em>The Computer Journal</em> 26 (4). Oxford University Press: 354–59.</p>
</div>
<div id="ref-Rousseeuw1987">
<p>Rousseeuw, Peter J. 1987. “Silhouettes: A Graphical Aid to the Interpretation and Validation of Cluster Analysis.” <em>Journal of Computational and Applied Mathematics</em> 20. North-Holland: 53–65.</p>
</div>
<div id="ref-Yeung2001">
<p>Yeung, Ka Yee, David R. Haynor, and Walter L. Ruzzo. 2001. “Validating Clustering for Gene Expression Data.” <em>Bioinformatics</em> 17 (4). Oxford University Press: 309–18.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Hervé Guillon, Alyssa DeVincentis, Noelle Patterson, Romina Diaz Gomez, Arthur Koehl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
