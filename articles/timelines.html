<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timelines â€¢ wateReview</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Timelines">
<meta property="og:description" content="wateReview">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wateReview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/wateReview.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Material and methods</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Corpus collection</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/making_query.html">making_query</a>
        </li>
        <li>
          <a href="../articles/query_processing.html">query_processing</a>
        </li>
        <li>
          <a href="../articles/query_QA.html">query_QA</a>
        </li>
        <li>
          <a href="../articles/manual_download.html">manual_download</a>
        </li>
        <li>
          <a href="../articles/select_human_reading.html">select_human_reading</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Topic Model</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/topic_model.html">topic_model</a>
        </li>
        <li>
          <a href="../articles/lda_model.html">lda_model</a>
        </li>
        <li>
          <a href="../articles/get_vocab.html">get_vocab</a>
        </li>
        <li>
          <a href="../articles/createjson.html">createjson</a>
        </li>
        <li>
          <a href="../articles/lda_vis.html">lda_vis</a>
        </li>
        <li>
          <a href="../articles/validation.html">validation</a>
        </li>
        <li>
          <a href="../articles/LDA_comparison.html">LDA_comparison</a>
        </li>
        <li>
          <a href="../articles/endnote_processing.html">endnote_processing</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Metadata mining</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/web_scrapping.html">web_scrapping</a>
        </li>
        <li>
          <a href="../articles/metadata_mining.html">metadata_mining</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Location predictions</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/text_mining.html">text_mining</a>
        </li>
        <li>
          <a href="../articles/webscrapped_training_labels.html">webscrapped_training_labels</a>
        </li>
        <li>
          <a href="../articles/ML_predictions.html">ML_predictions</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Socio-hydrologic clusters</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/clustering_analysis.html">Clustering analysis</a>
        </li>
        <li>
          <a href="../articles/cluster_map.html">Cluster map</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Electronic survey</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/get_emails.html">get_emails</a>
        </li>
        <li>
          <a href="../articles/survey_stats.html">survey_stats</a>
        </li>
      </ul>
</li>
    <li class="divider">
    <li class="dropdown-header">Analysis</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Research volume</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/timelines.html">Growth through time</a>
        </li>
        <li>
          <a href="../articles/chord_diagrams.html">Chord diagrams</a>
        </li>
        <li>
          <a href="../articles/country_colors.html">Colors of country flags</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Research spread</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/country_entropy.html">Country entropy</a>
        </li>
        <li>
          <a href="../articles/normality.html">Normality</a>
        </li>
        <li>
          <a href="../articles/hexagonal_maps.html">hexagonal_maps</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Connectivity</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/citation_network.html">Citation network</a>
        </li>
        <li>
          <a href="../articles/network_visualization.html">network_visualization</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="timelines_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="timelines_files/plotly-binding-4.9.2.1/plotly.js"></script><script src="timelines_files/typedarray-0.1/typedarray.min.js"></script><script src="timelines_files/jquery-1.11.3/jquery.min.js"></script><link href="timelines_files/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="timelines_files/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="timelines_files/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="timelines_files/plotly-main-1.52.2/plotly-latest.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Timelines</h1>
            
      
      
      <div class="hidden name"><code>timelines.Rmd</code></div>

    </div>

    
    
<div id="purpose" class="section level1">
<h1 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h1>
<p>This vignette presents the research growth through time.</p>
</div>
<div id="bla" class="section level1">
<h1 class="hasAnchor">
<a href="#bla" class="anchor"></a>Bla</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">wateReview</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co"># library(vegan)</span>
<span class="co"># library(broom)</span>
<span class="co"># library(reshape2)</span>
<span class="co"># library(viridis)</span>
<span class="co"># library(hrbrthemes)</span>
<span class="co"># library(ggplot2)</span>
<span class="co"># library(tidyr)</span>
<span class="co"># library(pracma)</span>
<span class="co"># library(wesanderson)</span></pre></body></html></div>
<p>We load the consolidated results for the entire corpus which contains the general topics caterogy and the predicted country.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">documents_year_location</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"consolidated_results_NSF_general.Rds"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"wateReview"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">year</span>, <span class="no">country</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">!=</span> <span class="st">"Irrelevant"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">country</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">country</span>))
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">documents_year_location</span>)
<span class="co">#&gt; [1] 12616     2</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">documents_year_location</span>)
<span class="co">#&gt;   year   country</span>
<span class="co">#&gt; 1 2011    Mexico</span>
<span class="co">#&gt; 2 2005  Colombia</span>
<span class="co">#&gt; 3 1992 Venezuela</span>
<span class="co">#&gt; 4 2016 Argentina</span>
<span class="co">#&gt; 5 2015     Chile</span>
<span class="co">#&gt; 6 2015    Brazil</span></pre></body></html></div>
<p>We group the country by <a href="clustering_analysis.html">clusters</a>. We define a convenience function to do so which assign the country cluster to <code>country</code> and take care of removing the the Carribean countries which were not clustered.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">assign_cluster</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">country</span>){
  <span class="no">cluster1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Mexico"</span>, <span class="st">"Brazil"</span>)
  <span class="no">cluster2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Chile"</span>, <span class="st">"Argentina"</span>, <span class="st">"Uruguay"</span>, <span class="st">"Suriname"</span>, <span class="st">"Guyana"</span>, <span class="st">"Belize"</span>, <span class="st">"Paraguay"</span>, <span class="st">"Costa.Rica"</span>, <span class="st">"Cuba"</span>, <span class="st">"Panama"</span>, <span class="st">"Venezuela"</span>)
  <span class="no">cluster3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Colombia"</span>, <span class="st">"Bolivia"</span>, <span class="st">"Jamaica"</span>, <span class="st">"Nicaragua"</span>, <span class="st">"El.Salvador"</span>, <span class="st">"Ecuador"</span>, <span class="st">"Honduras"</span>, <span class="st">"Guatemala"</span>, <span class="st">"Peru"</span>, <span class="st">"Dominican Republic"</span>)
  <span class="kw">if</span> (<span class="no">country</span> <span class="kw">%in%</span> <span class="no">cluster1</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">1</span>)
  } <span class="kw">else</span> <span class="kw">if</span> (<span class="no">country</span> <span class="kw">%in%</span> <span class="no">cluster2</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">2</span>)
  } <span class="kw">else</span> <span class="kw">if</span> (<span class="no">country</span> <span class="kw">%in%</span> <span class="no">cluster3</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">3</span>)
  } <span class="kw">else</span> {
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">NA</span>)
  }
}
<span class="no">documents_year_location</span> <span class="kw">&lt;-</span> <span class="no">documents_year_location</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cluster</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">country</span>, <span class="no">assign_cluster</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">documents_year_location</span>)
<span class="co">#&gt; [1] 12615     3</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">documents_year_location</span>)
<span class="co">#&gt;   year   country cluster</span>
<span class="co">#&gt; 1 2011    Mexico       1</span>
<span class="co">#&gt; 2 2005  Colombia       3</span>
<span class="co">#&gt; 3 1992 Venezuela       2</span>
<span class="co">#&gt; 4 2016 Argentina       2</span>
<span class="co">#&gt; 5 2015     Chile       2</span>
<span class="co">#&gt; 6 2015    Brazil       1</span></pre></body></html></div>
</div>
<div id="counting-documents-per-year-per-cluster" class="section level1">
<h1 class="hasAnchor">
<a href="#counting-documents-per-year-per-cluster" class="anchor"></a>Counting documents per year per cluster</h1>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">count_year_cluster</span> <span class="kw">&lt;-</span> <span class="no">documents_year_location</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">country</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">cluster</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_modify</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">.</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(- <span class="no">Var1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">year</span> <span class="kw">=</span> <span class="st">"."</span>, <span class="kw">count</span> <span class="kw">=</span> <span class="no">Freq</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cluster</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">cluster</span>), <span class="kw">year</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">year</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">year</span> <span class="kw">&gt;=</span> <span class="fl">1980</span>) <span class="kw">%&gt;%</span>
  <span class="co"># filter(year &lt; 2018) %&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span>(<span class="kw">year</span> <span class="kw">=</span> <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/full_seq.html">full_seq</a></span>(<span class="no">year</span>, <span class="kw">period</span> <span class="kw">=</span> <span class="fl">1</span>))
 <span class="no">count_year_cluster</span>$<span class="no">count</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">count_year_cluster</span>$<span class="no">count</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">count_year_cluster</span>)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt; # Groups:   cluster [1]</span>
<span class="co">#&gt;   cluster  year count</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1        1980     2</span>
<span class="co">#&gt; 2 1        1981     2</span>
<span class="co">#&gt; 3 1        1982     3</span>
<span class="co">#&gt; 4 1        1983     2</span>
<span class="co">#&gt; 5 1        1984     5</span>
<span class="co">#&gt; 6 1        1985     9</span></pre></body></html></div>
</div>
<div id="visualizing-growth-through-time" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-growth-through-time" class="anchor"></a>Visualizing growth through time</h1>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggpubr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">plotly</span>)
<span class="no">growth</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">count_year_cluster</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">count</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">cluster</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/theme_pubr.html">theme_pubr</a></span>(<span class="kw">legend</span> <span class="kw">=</span> <span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.6</span> , <span class="kw">size</span> <span class="kw">=</span><span class="fl">.5</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"white"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(
    <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#F8766D"</span>, <span class="st">"#00BFC4"</span>, <span class="st">"#7CAE00"</span>),
    <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cluster 1"</span>, <span class="st">"Cluster 2"</span>, <span class="st">"Cluster 3"</span>)
    ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(
    <span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">1</span>),
    <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">5</span>)
    ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(
    <span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
    <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>),
    <span class="kw">legend.title</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()
    ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"New water resources articles"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span>(<span class="no">growth</span>)</pre></body></html></div>
<div id="htmlwidget-a88acd3583d99fc6783a" style="width:672px;height:672px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a88acd3583d99fc6783a">{"x":{"data":[{"x":[1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000,1999,1998,1997,1996,1995,1994,1993,1992,1991,1990,1989,1988,1987,1986,1985,1984,1983,1982,1981,1980,1980],"y":[0,5,4,2,9,6,2,3,10,23,27,14,20,20,25,51,27,40,31,48,48,83,75,75,102,124,140,185,224,265,244,290,322,349,364,360,452,392,230,574,1221,1260,1001,929,902,855,770,688,630,637,508,415,294,262,200,227,187,125,128,90,98,72,107,55,57,49,46,46,43,26,13,11,15,14,4,7,7,2,0],"text":["year: 1980<br />count:   2<br />cluster: 1","year: 1981<br />count:   2<br />cluster: 1","year: 1982<br />count:   3<br />cluster: 1","year: 1983<br />count:   2<br />cluster: 1","year: 1984<br />count:   5<br />cluster: 1","year: 1985<br />count:   9<br />cluster: 1","year: 1986<br />count:   9<br />cluster: 1","year: 1987<br />count:  10<br />cluster: 1","year: 1988<br />count:  16<br />cluster: 1","year: 1989<br />count:  20<br />cluster: 1","year: 1990<br />count:  19<br />cluster: 1","year: 1991<br />count:  32<br />cluster: 1","year: 1992<br />count:  29<br />cluster: 1","year: 1993<br />count:  37<br />cluster: 1","year: 1994<br />count:  30<br />cluster: 1","year: 1995<br />count:  56<br />cluster: 1","year: 1996<br />count:  45<br />cluster: 1","year: 1997<br />count:  58<br />cluster: 1","year: 1998<br />count:  59<br />cluster: 1","year: 1999<br />count:  80<br />cluster: 1","year: 2000<br />count:  77<br />cluster: 1","year: 2001<br />count: 104<br />cluster: 1","year: 2002<br />count: 152<br />cluster: 1","year: 2003<br />count: 125<br />cluster: 1","year: 2004<br />count: 160<br />cluster: 1","year: 2005<br />count: 170<br />cluster: 1","year: 2006<br />count: 275<br />cluster: 1","year: 2007<br />count: 323<br />cluster: 1","year: 2008<br />count: 413<br />cluster: 1","year: 2009<br />count: 365<br />cluster: 1","year: 2010<br />count: 444<br />cluster: 1","year: 2011<br />count: 480<br />cluster: 1","year: 2012<br />count: 533<br />cluster: 1","year: 2013<br />count: 553<br />cluster: 1","year: 2014<br />count: 565<br />cluster: 1","year: 2015<br />count: 641<br />cluster: 1","year: 2016<br />count: 808<br />cluster: 1","year: 2017<br />count: 829<br />cluster: 1","year: 2018<br />count: 344<br />cluster: 1","year: 2018<br />count: 344<br />cluster: 1","year: 2017<br />count: 829<br />cluster: 1","year: 2016<br />count: 808<br />cluster: 1","year: 2015<br />count: 641<br />cluster: 1","year: 2014<br />count: 565<br />cluster: 1","year: 2013<br />count: 553<br />cluster: 1","year: 2012<br />count: 533<br />cluster: 1","year: 2011<br />count: 480<br />cluster: 1","year: 2010<br />count: 444<br />cluster: 1","year: 2009<br />count: 365<br />cluster: 1","year: 2008<br />count: 413<br />cluster: 1","year: 2007<br />count: 323<br />cluster: 1","year: 2006<br />count: 275<br />cluster: 1","year: 2005<br />count: 170<br />cluster: 1","year: 2004<br />count: 160<br />cluster: 1","year: 2003<br />count: 125<br />cluster: 1","year: 2002<br />count: 152<br />cluster: 1","year: 2001<br />count: 104<br />cluster: 1","year: 2000<br />count:  77<br />cluster: 1","year: 1999<br />count:  80<br />cluster: 1","year: 1998<br />count:  59<br />cluster: 1","year: 1997<br />count:  58<br />cluster: 1","year: 1996<br />count:  45<br />cluster: 1","year: 1995<br />count:  56<br />cluster: 1","year: 1994<br />count:  30<br />cluster: 1","year: 1993<br />count:  37<br />cluster: 1","year: 1992<br />count:  29<br />cluster: 1","year: 1991<br />count:  32<br />cluster: 1","year: 1990<br />count:  19<br />cluster: 1","year: 1989<br />count:  20<br />cluster: 1","year: 1988<br />count:  16<br />cluster: 1","year: 1987<br />count:  10<br />cluster: 1","year: 1986<br />count:   9<br />cluster: 1","year: 1985<br />count:   9<br />cluster: 1","year: 1984<br />count:   5<br />cluster: 1","year: 1983<br />count:   2<br />cluster: 1","year: 1982<br />count:   3<br />cluster: 1","year: 1981<br />count:   2<br />cluster: 1","year: 1980<br />count:   2<br />cluster: 1","year: 1980<br />count:   2<br />cluster: 1"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(255,255,255,0.6)","dash":"solid"},"fill":"toself","fillcolor":"rgba(248,118,109,0.6)","hoveron":"points","name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000,1999,1998,1997,1996,1995,1994,1993,1992,1991,1990,1989,1988,1987,1986,1985,1984,1983,1982,1981,1981],"y":[2,1,1,2,1,0,1,4,6,11,5,1,2,4,7,4,10,4,9,10,23,15,18,24,29,33,39,64,66,43,70,76,94,106,104,155,132,78,230,392,452,360,364,349,322,290,244,265,224,185,140,124,102,75,75,83,48,48,31,40,27,51,25,20,20,14,27,23,10,3,2,6,9,2,4,5,2],"text":["year: 1981<br />count:   3<br />cluster: 2","year: 1982<br />count:   3<br />cluster: 2","year: 1983<br />count:   1<br />cluster: 2","year: 1984<br />count:   7<br />cluster: 2","year: 1985<br />count:   5<br />cluster: 2","year: 1986<br />count:   2<br />cluster: 2","year: 1987<br />count:   2<br />cluster: 2","year: 1988<br />count:   6<br />cluster: 2","year: 1989<br />count:  17<br />cluster: 2","year: 1990<br />count:  16<br />cluster: 2","year: 1991<br />count:   9<br />cluster: 2","year: 1992<br />count:  19<br />cluster: 2","year: 1993<br />count:  18<br />cluster: 2","year: 1994<br />count:  21<br />cluster: 2","year: 1995<br />count:  44<br />cluster: 2","year: 1996<br />count:  23<br />cluster: 2","year: 1997<br />count:  30<br />cluster: 2","year: 1998<br />count:  27<br />cluster: 2","year: 1999<br />count:  39<br />cluster: 2","year: 2000<br />count:  38<br />cluster: 2","year: 2001<br />count:  60<br />cluster: 2","year: 2002<br />count:  60<br />cluster: 2","year: 2003<br />count:  57<br />cluster: 2","year: 2004<br />count:  78<br />cluster: 2","year: 2005<br />count:  95<br />cluster: 2","year: 2006<br />count: 107<br />cluster: 2","year: 2007<br />count: 146<br />cluster: 2","year: 2008<br />count: 160<br />cluster: 2","year: 2009<br />count: 199<br />cluster: 2","year: 2010<br />count: 201<br />cluster: 2","year: 2011<br />count: 220<br />cluster: 2","year: 2012<br />count: 246<br />cluster: 2","year: 2013<br />count: 255<br />cluster: 2","year: 2014<br />count: 258<br />cluster: 2","year: 2015<br />count: 256<br />cluster: 2","year: 2016<br />count: 297<br />cluster: 2","year: 2017<br />count: 260<br />cluster: 2","year: 2018<br />count: 152<br />cluster: 2","year: 2018<br />count: 152<br />cluster: 2","year: 2017<br />count: 260<br />cluster: 2","year: 2016<br />count: 297<br />cluster: 2","year: 2015<br />count: 256<br />cluster: 2","year: 2014<br />count: 258<br />cluster: 2","year: 2013<br />count: 255<br />cluster: 2","year: 2012<br />count: 246<br />cluster: 2","year: 2011<br />count: 220<br />cluster: 2","year: 2010<br />count: 201<br />cluster: 2","year: 2009<br />count: 199<br />cluster: 2","year: 2008<br />count: 160<br />cluster: 2","year: 2007<br />count: 146<br />cluster: 2","year: 2006<br />count: 107<br />cluster: 2","year: 2005<br />count:  95<br />cluster: 2","year: 2004<br />count:  78<br />cluster: 2","year: 2003<br />count:  57<br />cluster: 2","year: 2002<br />count:  60<br />cluster: 2","year: 2001<br />count:  60<br />cluster: 2","year: 2000<br />count:  38<br />cluster: 2","year: 1999<br />count:  39<br />cluster: 2","year: 1998<br />count:  27<br />cluster: 2","year: 1997<br />count:  30<br />cluster: 2","year: 1996<br />count:  23<br />cluster: 2","year: 1995<br />count:  44<br />cluster: 2","year: 1994<br />count:  21<br />cluster: 2","year: 1993<br />count:  18<br />cluster: 2","year: 1992<br />count:  19<br />cluster: 2","year: 1991<br />count:   9<br />cluster: 2","year: 1990<br />count:  16<br />cluster: 2","year: 1989<br />count:  17<br />cluster: 2","year: 1988<br />count:   6<br />cluster: 2","year: 1987<br />count:   2<br />cluster: 2","year: 1986<br />count:   2<br />cluster: 2","year: 1985<br />count:   5<br />cluster: 2","year: 1984<br />count:   7<br />cluster: 2","year: 1983<br />count:   1<br />cluster: 2","year: 1982<br />count:   3<br />cluster: 2","year: 1981<br />count:   3<br />cluster: 2","year: 1981<br />count:   3<br />cluster: 2"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(255,255,255,0.6)","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,191,196,0.6)","hoveron":"points","name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2018,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000,1999,1998,1997,1996,1995,1994,1993,1992,1991,1990,1989,1988,1987,1986,1985,1984,1983,1982,1981,1981],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,78,132,155,104,106,94,76,70,43,66,64,39,33,29,24,18,15,23,10,9,4,10,4,7,4,2,1,5,11,6,4,1,0,1,2,1,1,2,0],"text":["year: 1981<br />count:   2<br />cluster: 3","year: 1982<br />count:   1<br />cluster: 3","year: 1983<br />count:   1<br />cluster: 3","year: 1984<br />count:   2<br />cluster: 3","year: 1985<br />count:   1<br />cluster: 3","year: 1986<br />count:   0<br />cluster: 3","year: 1987<br />count:   1<br />cluster: 3","year: 1988<br />count:   4<br />cluster: 3","year: 1989<br />count:   6<br />cluster: 3","year: 1990<br />count:  11<br />cluster: 3","year: 1991<br />count:   5<br />cluster: 3","year: 1992<br />count:   1<br />cluster: 3","year: 1993<br />count:   2<br />cluster: 3","year: 1994<br />count:   4<br />cluster: 3","year: 1995<br />count:   7<br />cluster: 3","year: 1996<br />count:   4<br />cluster: 3","year: 1997<br />count:  10<br />cluster: 3","year: 1998<br />count:   4<br />cluster: 3","year: 1999<br />count:   9<br />cluster: 3","year: 2000<br />count:  10<br />cluster: 3","year: 2001<br />count:  23<br />cluster: 3","year: 2002<br />count:  15<br />cluster: 3","year: 2003<br />count:  18<br />cluster: 3","year: 2004<br />count:  24<br />cluster: 3","year: 2005<br />count:  29<br />cluster: 3","year: 2006<br />count:  33<br />cluster: 3","year: 2007<br />count:  39<br />cluster: 3","year: 2008<br />count:  64<br />cluster: 3","year: 2009<br />count:  66<br />cluster: 3","year: 2010<br />count:  43<br />cluster: 3","year: 2011<br />count:  70<br />cluster: 3","year: 2012<br />count:  76<br />cluster: 3","year: 2013<br />count:  94<br />cluster: 3","year: 2014<br />count: 106<br />cluster: 3","year: 2015<br />count: 104<br />cluster: 3","year: 2016<br />count: 155<br />cluster: 3","year: 2017<br />count: 132<br />cluster: 3","year: 2018<br />count:  78<br />cluster: 3","year: 2018<br />count:  78<br />cluster: 3","year: 2018<br />count:  78<br />cluster: 3","year: 2017<br />count: 132<br />cluster: 3","year: 2016<br />count: 155<br />cluster: 3","year: 2015<br />count: 104<br />cluster: 3","year: 2014<br />count: 106<br />cluster: 3","year: 2013<br />count:  94<br />cluster: 3","year: 2012<br />count:  76<br />cluster: 3","year: 2011<br />count:  70<br />cluster: 3","year: 2010<br />count:  43<br />cluster: 3","year: 2009<br />count:  66<br />cluster: 3","year: 2008<br />count:  64<br />cluster: 3","year: 2007<br />count:  39<br />cluster: 3","year: 2006<br />count:  33<br />cluster: 3","year: 2005<br />count:  29<br />cluster: 3","year: 2004<br />count:  24<br />cluster: 3","year: 2003<br />count:  18<br />cluster: 3","year: 2002<br />count:  15<br />cluster: 3","year: 2001<br />count:  23<br />cluster: 3","year: 2000<br />count:  10<br />cluster: 3","year: 1999<br />count:   9<br />cluster: 3","year: 1998<br />count:   4<br />cluster: 3","year: 1997<br />count:  10<br />cluster: 3","year: 1996<br />count:   4<br />cluster: 3","year: 1995<br />count:   7<br />cluster: 3","year: 1994<br />count:   4<br />cluster: 3","year: 1993<br />count:   2<br />cluster: 3","year: 1992<br />count:   1<br />cluster: 3","year: 1991<br />count:   5<br />cluster: 3","year: 1990<br />count:  11<br />cluster: 3","year: 1989<br />count:   6<br />cluster: 3","year: 1988<br />count:   4<br />cluster: 3","year: 1987<br />count:   1<br />cluster: 3","year: 1986<br />count:   0<br />cluster: 3","year: 1985<br />count:   1<br />cluster: 3","year: 1984<br />count:   2<br />cluster: 3","year: 1983<br />count:   1<br />cluster: 3","year: 1982<br />count:   1<br />cluster: 3","year: 1981<br />count:   2<br />cluster: 3","year: 1981<br />count:   2<br />cluster: 3"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(255,255,255,0.6)","dash":"solid"},"fill":"toself","fillcolor":"rgba(124,174,0,0.6)","hoveron":"points","name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.9701120797011,"r":7.97011207970112,"b":27.8953922789539,"l":59.7758405977584},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1978.1,2019.9],"tickmode":"array","ticktext":["1980","1985","1990","1995","2000","2005","2010","2015"],"tickvals":[1980,1985,1990,1995,2000,2005,2010,2015],"categoryorder":"array","categoryarray":["1980","1985","1990","1995","2000","2005","2010","2015"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.98505603985056,"tickwidth":0.724555643609193,"showticklabels":true,"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-63,1323],"tickmode":"array","ticktext":["0","500","1000"],"tickvals":[0,500,1000],"categoryorder":"array","categoryarray":["0","500","1000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.98505603985056,"tickwidth":0.724555643609193,"showticklabels":true,"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"New water resources articles","font":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":2.06156048675734,"font":{"color":"rgba(0,0,0,1)","family":"","size":12.7521793275218}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"54db6eecd427":{"x":{},"y":{},"fill":{},"type":"scatter"}},"cur_data":"54db6eecd427","visdat":{"54db6eecd427":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="residual-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#residual-analysis" class="anchor"></a>Residual analysis</h1>
<p>Recognizing an exponential growth, we perform a residual analysis by fitting an exponential curve to the general trend per cluster and evaluating the deviation from this general trend. We additionally flag if the residuals absolute values are greater than one-standard deviation of the residuals.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">residual_year_cluster</span> <span class="kw">&lt;-</span> <span class="no">count_year_cluster</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_modify</a></span>( ~ <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">year</span> <span class="kw">=</span> <span class="no">.x</span>$<span class="no">year</span>,
    <span class="kw">resid</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">count</span> + <span class="fl">1</span>) ~ <span class="no">year</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span>()
    ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/reexports.html">mutate</a></span>(<span class="kw">signif</span> <span class="kw">=</span> <span class="no">resid</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/reexports.html">mutate</a></span>(<span class="kw">signif</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">resid</span>) <span class="kw">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">resid</span>), <span class="fl">NA</span>, <span class="no">signif</span>))
  )
<span class="no">residual_year_cluster</span>
<span class="co">#&gt; # A tibble: 115 x 4</span>
<span class="co">#&gt; # Groups:   cluster [3]</span>
<span class="co">#&gt;    cluster  year    resid signif</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;lgl&gt; </span>
<span class="co">#&gt;  1 1        1980 -0.315   NA    </span>
<span class="co">#&gt;  2 1        1981 -0.465   FALSE </span>
<span class="co">#&gt;  3 1        1982 -0.327   FALSE </span>
<span class="co">#&gt;  4 1        1983 -0.764   FALSE </span>
<span class="co">#&gt;  5 1        1984 -0.221   NA    </span>
<span class="co">#&gt;  6 1        1985  0.140   NA    </span>
<span class="co">#&gt;  7 1        1986 -0.00971 NA    </span>
<span class="co">#&gt;  8 1        1987 -0.0642  NA    </span>
<span class="co">#&gt;  9 1        1988  0.221   NA    </span>
<span class="co">#&gt; 10 1        1989  0.283   NA    </span>
<span class="co">#&gt; # â€¦ with 105 more rows</span></pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">plot_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">.x</span>, <span class="no">.title</span> <span class="kw">=</span> <span class="no">.y</span>$<span class="no">cluster</span>){
  <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">.x</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">resid</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">resid</span> <span class="kw">&gt;</span> <span class="fl">0</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">signif</span>) +
    <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/theme_pubr.html">theme_pubr</a></span>(<span class="kw">legend</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>,<span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"grey20"</span>,<span class="st">"grey20"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">.x</span>$<span class="no">resid</span>), <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"grey50"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> -<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">.x</span>$<span class="no">resid</span>), <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"grey50"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">.title</span>, <span class="kw">y</span><span class="kw">=</span><span class="st">"Growth trend residuals"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(-<span class="fl">.5</span>, <span class="fl">.5</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">1</span>), <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="fl">5</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="fl">2000</span>, <span class="fl">NA</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">panel.grid.major.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">.3</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"solid"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"grey62"</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">p</span>)
}
<span class="no">residual_year_cluster</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_map</a></span>(~  <span class="fu">plot_fun</span>(<span class="no">.x</span>, <span class="kw">.title</span> <span class="kw">=</span> <span class="no">.y</span>$<span class="no">cluster</span>))
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span>
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span>
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; Warning: Removed 21 rows containing missing values (position_stack).</span>
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_bar).</span></pre></body></html></div>
<p><img src="timelines_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<pre><code>#&gt; 
#&gt; [[2]]
#&gt; Warning: Removed 20 rows containing missing values (position_stack).

#&gt; Warning: Removed 1 rows containing missing values (geom_bar).</code></pre>
<p><img src="timelines_files/figure-html/unnamed-chunk-6-2.png" width="672"></p>
<pre><code>#&gt; 
#&gt; [[3]]
#&gt; Warning: Removed 20 rows containing missing values (position_stack).

#&gt; Warning: Removed 1 rows containing missing values (geom_bar).</code></pre>
<p><img src="timelines_files/figure-html/unnamed-chunk-6-3.png" width="672"></p>
<pre><code>################### Optional: Detrending #########################
B_log = log(pivot$Braz_Mex + 1)
Ch_log = log(pivot$Chile_Argen + 1)
Co_log = log(pivot$Colom_Boliv + 1)
years = pivot$years
pivot_log = data_frame(years, B_log, Ch_log, Co_log)
pivot_log_long = melt(pivot_log, id = "years")

ggplot(data = pivot_log_long,
  aes(x = years, y = value, colour = variable)) +
  geom_line()

for (i in sequence(3)) {
  if (i == 1) {title = "Cluster 1"} 
  if (i == 2) {title = "Cluster 2"} 
  if (i == 3) {title = "Cluster 3"}
  model &lt;- lm(as.matrix(pivot_log[i+1]) ~ years)
  resid &lt;- resid(model)
  if (i == 1) {pivot_log$B_resid &lt;- resid
  title &lt;- "Cluster 1"} 
  if (i == 2) {pivot_log$Ch_resid &lt;- resid
  title &lt;- "Cluster 2"} 
  if (i == 3) {pivot_log$Co_resid &lt;- resid
  title &lt;- "Cluster 3"}
  sd &lt;- sd(resid)
  # plot(years, pivot_log[i+1][[1]], main=title)
  # abline(lm(pivot_log[i+1][[1]] ~ years))
  # plot(years, resid, xlab="years", ylab="residuals", main=title)
  # abline(0,0)
  # pivot_log$signif &lt;- resid &gt; 0
  # pivot_log$signif[abs(resid) &lt; sd] &lt;- NA
  
  print(ggplot(data=pivot_log, aes(x=years, y=resid, color = resid &gt; 0, fill = signif)) +
    theme_pubr(legend="none") +
    scale_fill_manual(values = c("black","black")) +
    scale_color_manual(values = c("grey20","grey20")) +
    geom_hline(yintercept = sd, linetype="dashed", color="grey50") +
    geom_hline(yintercept = -sd, linetype="dashed", color="grey50") +
    labs(title = title, y="Growth trend residuals") +
    theme(plot.title = element_text(hjust = 0.5)) +
    ylim(-.5, .5) +
    geom_bar(stat="identity") +
    theme(axis.title.x = element_blank(), legend.position = "none") +
    scale_x_continuous(minor_breaks = seq(1980, 2020, by=1), breaks=seq(1980, 2020, 5))) +
    # grids(axis = c("xy"), color = "grey92", size = NULL,
    # linetype = NULL)) +
    theme(panel.grid.major.x = element_line(size=.3, linetype="solid", color = "grey62")) +
    ggsave(filename = file.path("R/data_vis/figs",paste("cluster",substr(title,9,9),".png",sep="")), 
           device="png", units="in", width=6, height=3, dpi = 600)
}
  </code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">reshape2</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'reshape2'</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     smiths</span>

<span class="no">general</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"consolidated_results_NSF_general.Rds"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"wateReview"</span>))
<span class="co">################### Countries chronology #########################</span>

<span class="no">general</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">general</span>, <span class="kw">select</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">year</span>, <span class="no">country</span>))
<span class="no">general</span> <span class="kw">&lt;-</span> <span class="no">general</span>[<span class="no">general</span>$<span class="no">country</span> <span class="kw">!=</span> <span class="st">"Irrelevant"</span>, ]
<span class="no">general</span>$<span class="no">country</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">general</span>$<span class="no">country</span>)
<span class="co"># arrange country clusters</span>
<span class="no">braz_mex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Mexico"</span>, <span class="st">"Brazil"</span>)
<span class="no">chile_argen</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Chile"</span>, <span class="st">"Argentina"</span>, <span class="st">"Uruguay"</span>, <span class="st">"Suriname"</span>, <span class="st">"Guyana"</span>, <span class="st">"Belize"</span>, <span class="st">"Paraguay"</span>, <span class="st">"Costa.Rica"</span>, <span class="st">"Cuba"</span>, <span class="st">"Panama"</span>, <span class="st">"Venezuela"</span>)
<span class="no">colom_boliv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Colombia"</span>, <span class="st">"Bolivia"</span>, <span class="st">"Jamaica"</span>, <span class="st">"Nicaragua"</span>, <span class="st">"El.Salvador"</span>, <span class="st">"Ecuador"</span>, <span class="st">"Honduras"</span>, <span class="st">"Guatemala"</span>, <span class="st">"Peru"</span>, <span class="st">"Dominican Republic"</span>)
<span class="no">general</span>$<span class="no">country</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">general</span>$<span class="no">country</span>, <span class="no">braz_mex</span>)))] <span class="kw">&lt;-</span> <span class="st">"Braz_Mex"</span>
<span class="no">general</span>$<span class="no">country</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">general</span>$<span class="no">country</span>, <span class="no">chile_argen</span>)))] <span class="kw">&lt;-</span> <span class="st">"Chile_Argen"</span>
<span class="no">general</span>$<span class="no">country</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">general</span>$<span class="no">country</span>, <span class="no">colom_boliv</span>)))] <span class="kw">&lt;-</span> <span class="st">"Colom_Boliv"</span>
<span class="co"># Drop rows with caribbean countries excluded from clusters?</span>
<span class="no">general</span> <span class="kw">&lt;-</span> <span class="no">general</span>[!(<span class="no">general</span>$<span class="no">country</span> <span class="kw">==</span> <span class="st">"Bahamas"</span> <span class="kw">|</span> <span class="no">general</span>$<span class="no">country</span> <span class="kw">==</span> <span class="st">"Haiti"</span>),]
<span class="no">pivot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">general</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">country</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">year</span>, <span class="no">country</span>), <span class="no">length</span>))
<span class="no">years</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(<span class="no">pivot</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">pivot</span>) <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="no">pivot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span>(<span class="no">years</span>, <span class="no">pivot</span>)
<span class="no">pivot</span> <span class="kw">&lt;-</span> <span class="no">pivot</span>[!(<span class="no">pivot</span>$<span class="no">years</span> <span class="kw">==</span> <span class="fl">2018</span>),]
<span class="no">pivot</span>$<span class="no">years</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html">strtoi</a></span>(<span class="no">pivot</span>$<span class="no">years</span>)
<span class="no">pivot</span> <span class="kw">&lt;-</span> <span class="no">pivot</span>[(<span class="no">pivot</span>$<span class="no">years</span> <span class="kw">&gt;</span> <span class="fl">1979</span>),]
<span class="no">pivot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span>(<span class="no">pivot</span>, <span class="kw">years</span> <span class="kw">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/full_seq.html">full_seq</a></span>(<span class="no">years</span>, <span class="kw">period</span> <span class="kw">=</span> <span class="fl">1</span>))
<span class="no">pivot</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">pivot</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="no">pivot_long</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">pivot</span>, <span class="no">country</span>, <span class="no">count</span>, <span class="no">Braz_Mex</span>:<span class="no">Colom_Boliv</span>, <span class="kw">factor_key</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pivot_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">years</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">count</span>, <span class="kw">fill</span><span class="kw">=</span><span class="no">country</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/theme_pubr.html">theme_pubr</a></span>(<span class="kw">legend</span><span class="kw">=</span><span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span>(<span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.6</span> , <span class="kw">size</span><span class="kw">=</span><span class="fl">.5</span>, <span class="kw">colour</span><span class="kw">=</span><span class="st">"white"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#F8766D"</span>, <span class="st">"#00BFC4"</span>, <span class="st">"#7CAE00"</span>),
                    <span class="kw">labels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cluster 1"</span>, <span class="st">"Cluster 2"</span>, <span class="st">"Cluster 3"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">1</span>), <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">5</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>),
        <span class="kw">legend.title</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"New water resources articles"</span>)</pre></body></html></div>
<p><img src="timelines_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r">  <span class="co"># ggtitle("Country clusters over time") </span>
<span class="co">################### Optional: Detrending #########################</span>
<span class="no">B_log</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">pivot</span>$<span class="no">Braz_Mex</span> + <span class="fl">1</span>)
<span class="no">Ch_log</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">pivot</span>$<span class="no">Chile_Argen</span> + <span class="fl">1</span>)
<span class="no">Co_log</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">pivot</span>$<span class="no">Colom_Boliv</span> + <span class="fl">1</span>)
<span class="no">years</span> <span class="kw">=</span> <span class="no">pivot</span>$<span class="no">years</span>
<span class="no">pivot_log</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="no">years</span>, <span class="no">B_log</span>, <span class="no">Ch_log</span>, <span class="no">Co_log</span>)
<span class="co">#&gt; Warning: `data_frame()` is deprecated as of tibble 1.1.0.</span>
<span class="co">#&gt; Please use `tibble()` instead.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span>
<span class="no">pivot_log_long</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span>(<span class="no">pivot_log</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">"years"</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">pivot_log_long</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">years</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">value</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">variable</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</pre></body></html></div>
<p><img src="timelines_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/sequence.html">sequence</a></span>(<span class="fl">3</span>)) {
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">1</span>) {<span class="no">title</span> <span class="kw">=</span> <span class="st">"Cluster 1"</span>}
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">2</span>) {<span class="no">title</span> <span class="kw">=</span> <span class="st">"Cluster 2"</span>}
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">3</span>) {<span class="no">title</span> <span class="kw">=</span> <span class="st">"Cluster 3"</span>}
  <span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">pivot_log</span>[<span class="no">i</span>+<span class="fl">1</span>]) ~ <span class="no">years</span>)
  <span class="no">resid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span>(<span class="no">model</span>)
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">1</span>) {<span class="no">pivot_log</span>$<span class="no">B_resid</span> <span class="kw">&lt;-</span> <span class="no">resid</span>
  <span class="no">title</span> <span class="kw">&lt;-</span> <span class="st">"Cluster 1"</span>}
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">2</span>) {<span class="no">pivot_log</span>$<span class="no">Ch_resid</span> <span class="kw">&lt;-</span> <span class="no">resid</span>
  <span class="no">title</span> <span class="kw">&lt;-</span> <span class="st">"Cluster 2"</span>}
  <span class="kw">if</span> (<span class="no">i</span> <span class="kw">==</span> <span class="fl">3</span>) {<span class="no">pivot_log</span>$<span class="no">Co_resid</span> <span class="kw">&lt;-</span> <span class="no">resid</span>
  <span class="no">title</span> <span class="kw">&lt;-</span> <span class="st">"Cluster 3"</span>}
  <span class="no">sd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">resid</span>)
  <span class="co"># plot(years, pivot_log[i+1][[1]], main=title)</span>
  <span class="co"># abline(lm(pivot_log[i+1][[1]] ~ years))</span>
  <span class="co"># plot(years, resid, xlab="years", ylab="residuals", main=title)</span>
  <span class="co"># abline(0,0)</span>
  <span class="no">pivot_log</span>$<span class="no">signif</span> <span class="kw">&lt;-</span> <span class="no">resid</span> <span class="kw">&gt;</span> <span class="fl">0</span>
  <span class="no">pivot_log</span>$<span class="no">signif</span>[<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">resid</span>) <span class="kw">&lt;</span> <span class="no">sd</span>] <span class="kw">&lt;-</span> <span class="fl">NA</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">pivot_log</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">years</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">resid</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">resid</span> <span class="kw">&gt;</span> <span class="fl">0</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">signif</span>)) +
    <span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/theme_pubr.html">theme_pubr</a></span>(<span class="kw">legend</span><span class="kw">=</span><span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>,<span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"grey20"</span>,<span class="st">"grey20"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">sd</span>, <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"grey50"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> -<span class="no">sd</span>, <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"grey50"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">title</span>, <span class="kw">y</span><span class="kw">=</span><span class="st">"Growth trend residuals"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(-<span class="fl">.5</span>, <span class="fl">.5</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span><span class="kw">=</span><span class="st">"identity"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">minor_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">1</span>), <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1980</span>, <span class="fl">2020</span>, <span class="fl">5</span>))) +
    <span class="co"># grids(axis = c("xy"), color = "grey92", size = NULL,</span>
    <span class="co"># linetype = NULL)) +</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">panel.grid.major.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">.3</span>, <span class="kw">linetype</span><span class="kw">=</span><span class="st">"solid"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"grey62"</span>))
}
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (position_stack).</span></pre></body></html></div>
<p><img src="timelines_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<pre><code>#&gt; Warning: Removed 8 rows containing missing values (position_stack).</code></pre>
<p><img src="timelines_files/figure-html/unnamed-chunk-7-4.png" width="672"></p>
<pre><code>#&gt; Warning: Removed 8 rows containing missing values (position_stack).</code></pre>
<p><img src="timelines_files/figure-html/unnamed-chunk-7-5.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by HervÃ© Guillon, Alyssa DeVincentis, Noelle Patterson, Romina Diaz Gomez, Arthur Koehl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
